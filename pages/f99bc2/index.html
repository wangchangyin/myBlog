<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JUC笔记 | CY blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/myBlogimg/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script,[object Object]></script,[object Object]>
    <meta name="description" content="CY,长印,技术博客,java,Spring,SpringBoot,SpringCloud,git,github等技术文章。">
    <meta name="keywords" content="CY,长印,技术博客,java,Spring,SpringBoot,SpringCloud,git,github等技术文章。">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/myBlog/assets/css/0.styles.713dba05.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.6034fc33.js" as="script"><link rel="preload" href="/myBlog/assets/js/2.ecdec458.js" as="script"><link rel="preload" href="/myBlog/assets/js/18.3f280d96.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.7b0bdbd0.js"><link rel="prefetch" href="/myBlog/assets/js/100.5416bab4.js"><link rel="prefetch" href="/myBlog/assets/js/101.322c2725.js"><link rel="prefetch" href="/myBlog/assets/js/102.6b37be73.js"><link rel="prefetch" href="/myBlog/assets/js/103.6a821d54.js"><link rel="prefetch" href="/myBlog/assets/js/104.553a15b2.js"><link rel="prefetch" href="/myBlog/assets/js/105.f50b9a58.js"><link rel="prefetch" href="/myBlog/assets/js/106.439dbb4c.js"><link rel="prefetch" href="/myBlog/assets/js/107.550a13d3.js"><link rel="prefetch" href="/myBlog/assets/js/108.4fc6267e.js"><link rel="prefetch" href="/myBlog/assets/js/109.b0edf676.js"><link rel="prefetch" href="/myBlog/assets/js/11.5afa7e04.js"><link rel="prefetch" href="/myBlog/assets/js/110.e3256446.js"><link rel="prefetch" href="/myBlog/assets/js/111.f44da157.js"><link rel="prefetch" href="/myBlog/assets/js/112.cf2b7ccf.js"><link rel="prefetch" href="/myBlog/assets/js/113.ce23b62b.js"><link rel="prefetch" href="/myBlog/assets/js/114.a4efd687.js"><link rel="prefetch" href="/myBlog/assets/js/115.f37c3244.js"><link rel="prefetch" href="/myBlog/assets/js/116.a466bcbc.js"><link rel="prefetch" href="/myBlog/assets/js/117.f3ed6df6.js"><link rel="prefetch" href="/myBlog/assets/js/118.4019db0d.js"><link rel="prefetch" href="/myBlog/assets/js/119.2050eed3.js"><link rel="prefetch" href="/myBlog/assets/js/12.208e8480.js"><link rel="prefetch" href="/myBlog/assets/js/120.ce1004d6.js"><link rel="prefetch" href="/myBlog/assets/js/121.056aa58e.js"><link rel="prefetch" href="/myBlog/assets/js/122.ef174806.js"><link rel="prefetch" href="/myBlog/assets/js/123.af09e00a.js"><link rel="prefetch" href="/myBlog/assets/js/124.ff9f9b8b.js"><link rel="prefetch" href="/myBlog/assets/js/125.e426eee1.js"><link rel="prefetch" href="/myBlog/assets/js/126.0f67baf6.js"><link rel="prefetch" href="/myBlog/assets/js/127.d67b38ff.js"><link rel="prefetch" href="/myBlog/assets/js/128.44180ed5.js"><link rel="prefetch" href="/myBlog/assets/js/129.04983d17.js"><link rel="prefetch" href="/myBlog/assets/js/13.091a9ce4.js"><link rel="prefetch" href="/myBlog/assets/js/130.7521f0a4.js"><link rel="prefetch" href="/myBlog/assets/js/131.a1a68795.js"><link rel="prefetch" href="/myBlog/assets/js/132.07b70dd7.js"><link rel="prefetch" href="/myBlog/assets/js/133.cb6080fb.js"><link rel="prefetch" href="/myBlog/assets/js/134.d06e708e.js"><link rel="prefetch" href="/myBlog/assets/js/135.601c5b41.js"><link rel="prefetch" href="/myBlog/assets/js/136.4fb4f7cb.js"><link rel="prefetch" href="/myBlog/assets/js/137.5dfd3b84.js"><link rel="prefetch" href="/myBlog/assets/js/138.5fa36b65.js"><link rel="prefetch" href="/myBlog/assets/js/139.7d480183.js"><link rel="prefetch" href="/myBlog/assets/js/14.7151b9d7.js"><link rel="prefetch" href="/myBlog/assets/js/140.7404d5f7.js"><link rel="prefetch" href="/myBlog/assets/js/141.d6640d22.js"><link rel="prefetch" href="/myBlog/assets/js/15.bb6acdb2.js"><link rel="prefetch" href="/myBlog/assets/js/16.6067bc94.js"><link rel="prefetch" href="/myBlog/assets/js/17.2ee3b538.js"><link rel="prefetch" href="/myBlog/assets/js/19.0c0231bb.js"><link rel="prefetch" href="/myBlog/assets/js/20.03b49756.js"><link rel="prefetch" href="/myBlog/assets/js/21.a144ec70.js"><link rel="prefetch" href="/myBlog/assets/js/22.be5e0407.js"><link rel="prefetch" href="/myBlog/assets/js/23.4198eb77.js"><link rel="prefetch" href="/myBlog/assets/js/24.5e54e47d.js"><link rel="prefetch" href="/myBlog/assets/js/25.0c7199fe.js"><link rel="prefetch" href="/myBlog/assets/js/26.7a5291cd.js"><link rel="prefetch" href="/myBlog/assets/js/27.b83b7f1a.js"><link rel="prefetch" href="/myBlog/assets/js/28.5477d887.js"><link rel="prefetch" href="/myBlog/assets/js/29.6ec32ac6.js"><link rel="prefetch" href="/myBlog/assets/js/3.3c4324a9.js"><link rel="prefetch" href="/myBlog/assets/js/30.a9eb9b15.js"><link rel="prefetch" href="/myBlog/assets/js/31.a6496a14.js"><link rel="prefetch" href="/myBlog/assets/js/32.b5379dbf.js"><link rel="prefetch" href="/myBlog/assets/js/33.78a535a0.js"><link rel="prefetch" href="/myBlog/assets/js/34.e6d4ad66.js"><link rel="prefetch" href="/myBlog/assets/js/35.ff8631ac.js"><link rel="prefetch" href="/myBlog/assets/js/36.db442c21.js"><link rel="prefetch" href="/myBlog/assets/js/37.c1ba9523.js"><link rel="prefetch" href="/myBlog/assets/js/38.6768b09a.js"><link rel="prefetch" href="/myBlog/assets/js/39.c9f1fd72.js"><link rel="prefetch" href="/myBlog/assets/js/4.b0209c65.js"><link rel="prefetch" href="/myBlog/assets/js/40.35777943.js"><link rel="prefetch" href="/myBlog/assets/js/41.43e2f1d1.js"><link rel="prefetch" href="/myBlog/assets/js/42.9597c193.js"><link rel="prefetch" href="/myBlog/assets/js/43.ef6af607.js"><link rel="prefetch" href="/myBlog/assets/js/44.db0b54b7.js"><link rel="prefetch" href="/myBlog/assets/js/45.12cb4bef.js"><link rel="prefetch" href="/myBlog/assets/js/46.893e1c56.js"><link rel="prefetch" href="/myBlog/assets/js/47.52493713.js"><link rel="prefetch" href="/myBlog/assets/js/48.158af2b8.js"><link rel="prefetch" href="/myBlog/assets/js/49.0075d84b.js"><link rel="prefetch" href="/myBlog/assets/js/5.27284ffb.js"><link rel="prefetch" href="/myBlog/assets/js/50.8c3be9f5.js"><link rel="prefetch" href="/myBlog/assets/js/51.2cee7923.js"><link rel="prefetch" href="/myBlog/assets/js/52.49f65b56.js"><link rel="prefetch" href="/myBlog/assets/js/53.64bfd10a.js"><link rel="prefetch" href="/myBlog/assets/js/54.d29bf96b.js"><link rel="prefetch" href="/myBlog/assets/js/55.185dab47.js"><link rel="prefetch" href="/myBlog/assets/js/56.c9fd3894.js"><link rel="prefetch" href="/myBlog/assets/js/57.c0a0dfed.js"><link rel="prefetch" href="/myBlog/assets/js/58.ad8ca2f6.js"><link rel="prefetch" href="/myBlog/assets/js/59.efeae7ff.js"><link rel="prefetch" href="/myBlog/assets/js/6.57ebcb36.js"><link rel="prefetch" href="/myBlog/assets/js/60.1c31cf41.js"><link rel="prefetch" href="/myBlog/assets/js/61.da830dc9.js"><link rel="prefetch" href="/myBlog/assets/js/62.68ba7528.js"><link rel="prefetch" href="/myBlog/assets/js/63.7ca1f04a.js"><link rel="prefetch" href="/myBlog/assets/js/64.43e071a5.js"><link rel="prefetch" href="/myBlog/assets/js/65.55233d69.js"><link rel="prefetch" href="/myBlog/assets/js/66.d1b2c741.js"><link rel="prefetch" href="/myBlog/assets/js/67.f594913f.js"><link rel="prefetch" href="/myBlog/assets/js/68.02f2b732.js"><link rel="prefetch" href="/myBlog/assets/js/69.467048f6.js"><link rel="prefetch" href="/myBlog/assets/js/7.8ff1cc95.js"><link rel="prefetch" href="/myBlog/assets/js/70.b1045043.js"><link rel="prefetch" href="/myBlog/assets/js/71.42286b79.js"><link rel="prefetch" href="/myBlog/assets/js/72.46581568.js"><link rel="prefetch" href="/myBlog/assets/js/73.74e29ee5.js"><link rel="prefetch" href="/myBlog/assets/js/74.a797456b.js"><link rel="prefetch" href="/myBlog/assets/js/75.38d01bd0.js"><link rel="prefetch" href="/myBlog/assets/js/76.ad6eefc3.js"><link rel="prefetch" href="/myBlog/assets/js/77.663c63dd.js"><link rel="prefetch" href="/myBlog/assets/js/78.5f1858b7.js"><link rel="prefetch" href="/myBlog/assets/js/79.327b53e7.js"><link rel="prefetch" href="/myBlog/assets/js/8.63f9549b.js"><link rel="prefetch" href="/myBlog/assets/js/80.60deb9cb.js"><link rel="prefetch" href="/myBlog/assets/js/81.e6af767f.js"><link rel="prefetch" href="/myBlog/assets/js/82.37c4c554.js"><link rel="prefetch" href="/myBlog/assets/js/83.32b7b26f.js"><link rel="prefetch" href="/myBlog/assets/js/84.5fb5e87e.js"><link rel="prefetch" href="/myBlog/assets/js/85.25a29421.js"><link rel="prefetch" href="/myBlog/assets/js/86.b00447c9.js"><link rel="prefetch" href="/myBlog/assets/js/87.6b326a02.js"><link rel="prefetch" href="/myBlog/assets/js/88.adced1fc.js"><link rel="prefetch" href="/myBlog/assets/js/89.a59352d1.js"><link rel="prefetch" href="/myBlog/assets/js/9.566067df.js"><link rel="prefetch" href="/myBlog/assets/js/90.105072b7.js"><link rel="prefetch" href="/myBlog/assets/js/91.c1fd6382.js"><link rel="prefetch" href="/myBlog/assets/js/92.294df929.js"><link rel="prefetch" href="/myBlog/assets/js/93.85c3ce26.js"><link rel="prefetch" href="/myBlog/assets/js/94.9ef2cb4c.js"><link rel="prefetch" href="/myBlog/assets/js/95.521183de.js"><link rel="prefetch" href="/myBlog/assets/js/96.ba7fcc56.js"><link rel="prefetch" href="/myBlog/assets/js/97.1db11d02.js"><link rel="prefetch" href="/myBlog/assets/js/98.75156849.js"><link rel="prefetch" href="/myBlog/assets/js/99.ce5f296b.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.713dba05.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myBlog/" class="home-link router-link-active"><img src="/myBlogimg/EB-logo.png" alt="CY blog" class="logo"> <span class="site-name can-hide">CY blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/myBlog/back-end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/myBlog/pages/4400b9/" class="nav-link">java</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/31cb74/" class="nav-link">数据库</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/44c61f/" class="nav-link">linux</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/261ec0/" class="nav-link">数据结构</a></li></ul></li><li class="dropdown-item"><h4>Spring全家桶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/myBlog/pages/9f1398/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/e3c3e5/" class="nav-link">mybatis</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/9af6ea/" class="nav-link">SpringBoot</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/5ca4e4/" class="nav-link">SpringCloud</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/myBlog/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/pages/1f749b/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/9ff38f/" class="nav-link">Layui</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/myBlog/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/tool/" class="nav-link">工具使用</a></li><li class="dropdown-item"><!----> <a href="/myBlog/interview/" class="nav-link">面试笔记</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/9fef0c/" class="nav-link">环境搭建</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/0d18d5/" class="nav-link">项目笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/myBlog/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/myBlog/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/myBlog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/myBlog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/myBlog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/myBlog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/wangchangyin/myBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/119-working.png"> <div class="blogger-info"><h3>Changyin Wang</h3> <span>后端界的学习者</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/myBlog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/myBlog/back-end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/myBlog/pages/4400b9/" class="nav-link">java</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/31cb74/" class="nav-link">数据库</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/44c61f/" class="nav-link">linux</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/261ec0/" class="nav-link">数据结构</a></li></ul></li><li class="dropdown-item"><h4>Spring全家桶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/myBlog/pages/9f1398/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/e3c3e5/" class="nav-link">mybatis</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/9af6ea/" class="nav-link">SpringBoot</a></li><li class="dropdown-subitem"><a href="/myBlog/pages/5ca4e4/" class="nav-link">SpringCloud</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/myBlog/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/pages/1f749b/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/9ff38f/" class="nav-link">Layui</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/myBlog/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/tool/" class="nav-link">工具使用</a></li><li class="dropdown-item"><!----> <a href="/myBlog/interview/" class="nav-link">面试笔记</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/9fef0c/" class="nav-link">环境搭建</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/0d18d5/" class="nav-link">项目笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/myBlog/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/myBlog/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/myBlog/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/myBlog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/myBlog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/myBlog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/myBlog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/wangchangyin/myBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JUC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/pages/f99bc2/" aria-current="page" class="active sidebar-link">JUC笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#一-并发题-售票员卖票" class="sidebar-link">一.并发题（售票员卖票）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_1-1-旧版写法synchronized" class="sidebar-link">1.1.旧版写法synchronized：</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_1-2-新版写法lock" class="sidebar-link">1.2.新版写法Lock：</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#二-复习lambda表达式" class="sidebar-link">二.复习lambda表达式</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#三-生产者消费者模式" class="sidebar-link">三.生产者消费者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_3-1-wait、notify的使用" class="sidebar-link">3.1.Wait、notify的使用</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_3-2-lock、condition的使用" class="sidebar-link">3.2.lock、Condition的使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#四-lock、condition实现精准通知" class="sidebar-link">四.Lock、condition实现精准通知</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_4-1-使用wait、notify实现" class="sidebar-link">4.1.使用wait、notify实现</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_4-2-使用lock、condition实现" class="sidebar-link">4.2.使用lock、condition实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#五-8锁" class="sidebar-link">五.8锁</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#六-list" class="sidebar-link">六.List</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_6-1-arraylist" class="sidebar-link">6.1.ArrayList</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_6-2-collections-synchronizedlist-new-arraylist" class="sidebar-link">6.2.Collections.synchronizedList(new ArrayList());</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_6-3-copyonwritearraylist" class="sidebar-link">6.3.CopyOnWriteArrayList</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#七-set" class="sidebar-link">七.Set</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_7-1-hashset" class="sidebar-link">7.1.HashSet</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_7-2-collections-synchronizedset-new-hashset" class="sidebar-link">7.2.Collections.synchronizedSet(new HashSet());</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_7-3-copyonwritearrayset" class="sidebar-link">7.3.CopyOnWriteArraySet</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#八-map" class="sidebar-link">八.Map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_8-1-hashmap" class="sidebar-link">8.1.HashMap</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_8-2-hashtable" class="sidebar-link">8.2.HashTable</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_8-3-collections-synchronizedmap-new-hashmap-string-string" class="sidebar-link">8.3.Collections.synchronizedMap(new HashMap());</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_8-4-new-concurrenthashmap" class="sidebar-link">8.4.new ConcurrentHashMap();</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#九-callable" class="sidebar-link">九.Callable</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_9-1-callable和runable的区别" class="sidebar-link">9.1.callable和runable的区别：</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_9-2-使用callable" class="sidebar-link">9.2.使用callable</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#十-等待多个子线程完成了-主线程再后续执行" class="sidebar-link">十.等待多个子线程完成了，主线程再后续执行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_1-countdownlatch-倒计时锁" class="sidebar-link">1.CountDownLatch(倒计时锁)</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_2-cyclicbarrier-计数器" class="sidebar-link">2.CyclicBarrier（计数器）</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#十一-semaphore信号量" class="sidebar-link">十一.Semaphore信号量</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#十二-readwritelock-读写锁" class="sidebar-link">十二.ReadWriteLock(读写锁)</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#十三-blokingqueue阻塞队列种类" class="sidebar-link">十三.BlokingQueue阻塞队列种类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_13-1-阻塞队列" class="sidebar-link">13.1.阻塞队列：</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_13-2-阻塞队列的种类" class="sidebar-link">13.2.阻塞队列的种类：</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_13-3-阻塞队列的操作" class="sidebar-link">13.3.阻塞队列的操作：</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#十四-了解java的值传递" class="sidebar-link">十四.了解java的值传递</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#十五-线程池" class="sidebar-link">十五.线程池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_1-为什么使用多线程" class="sidebar-link">1.为什么使用多线程？</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_2-线程池类图" class="sidebar-link">2.线程池类图</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_3-线程池工具类-阿里巴巴强制说明不准使用-需自己new" class="sidebar-link">3.线程池工具类（阿里巴巴强制说明不准使用，需自己new）</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_4-线程池七大参数" class="sidebar-link">4.线程池七大参数</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_5-线程池的执行流程" class="sidebar-link">5.线程池的执行流程</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_6-自定义线程池" class="sidebar-link">6.自定义线程池</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_7-拒绝策略" class="sidebar-link">7.拒绝策略</a></li><li class="sidebar-sub-header"><a href="/myBlog/pages/f99bc2/#_8-最大线程的值如何确认" class="sidebar-link">8.最大线程的值如何确认？</a></li></ul></li></ul></li><li><a href="/myBlog/pages/dea0da/" class="sidebar-link">java并发编程之美（笔记）</a></li><li><a href="/myBlog/pages/c67291/" class="sidebar-link">java主线程等待所有子线程执行完毕再执行</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring全家桶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>消息队列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Sa-Token</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/myBlog/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/myBlog/back-end" title="后端-目录页" data-v-1cd794fe>后端</a></li> <li data-v-1cd794fe><a href="/myBlog/back-end/#JUC" title="后端#JUC" data-v-1cd794fe>JUC</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/wangchangyin" target="_blank" title="作者" class="beLink" data-v-1cd794fe>changyin.Wang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-07-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          JUC笔记
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="juc-尚硅谷阳哥-笔记"><a href="#juc-尚硅谷阳哥-笔记" class="header-anchor">#</a> JUC（尚硅谷阳哥）笔记</h1> <p>2020权威_juc 与 jvm <em>并发编程</em> Java 必学_阳哥- 尚硅谷视频地址：</p> <p>https://www.bilibili.com/video/BV1vE411D7KE?p=38</p> <blockquote><p>多线程编程企业级套路+模板</p> <ul><li>高内聚低耦合</li> <li>口诀：
<ul><li>1、线程操作资源类</li> <li>2、若有横向通知，判断--干活--通知</li> <li>3、线程交互中，必须要防止多线程的虚假唤醒，也即（判断只用while，不能用f）</li> <li>4、需要顺序则用标志位</li></ul></li></ul></blockquote> <h2 id="一-并发题-售票员卖票"><a href="#一-并发题-售票员卖票" class="header-anchor">#</a> 一.并发题（售票员卖票）</h2> <h3 id="_1-1-旧版写法synchronized"><a href="#_1-1-旧版写法synchronized" class="header-anchor">#</a> 1.1.旧版写法synchronized：</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

/**
 * 三个售票员 卖20张票
 *
 * 多线程编程企业级套路+模板
 * 高内聚低耦合
 * 口诀： 线程    操作     资源类
 */
public class SaleTicket {
    public static void main(String[] args) {
        Ticket ticket=new Ticket();
        for (int i = 0; i &lt; 3; i++) {
            new Thread(new Runnable() {//匿名内部类的写法
                @Override
                public void run() {
                    for (int j = 0; j &lt; 40; j++) {
                        ticket.saleTicket();
                    }
                }
            },i+&quot;售票员&quot;).start();
        }
    }
}
class Ticket{
    private int ticketNum=30;//票数

    public synchronized void saleTicket(){
        if(this.ticketNum &gt; 0){
            System.out.println(Thread.currentThread().getName()+&quot;卖出第&quot;+ticketNum--+&quot;票，还剩下&quot;+ticketNum+&quot;票&quot;);
        }
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_1-2-新版写法lock"><a href="#_1-2-新版写法lock" class="header-anchor">#</a> 1.2.新版写法Lock：</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

/**
 * 三个售票员 卖20张票
 *
 * 多线程编程企业级套路+模板
 * 高内聚低耦合
 * 口诀： 线程    操作     资源类
 */
public class SaleTicket {
    public static void main(String[] args) {
        Ticket ticket=new Ticket();
        for (int i = 0; i &lt; 3; i++) {
//            new Thread(new Runnable() {//匿名内部类的写法
//                @Override
//                public void run() {
//                    for (int j = 0; j &lt; 40; j++) {
//                        ticket.saleTicket();
//                    }
//                }
//            },i+&quot;售票员&quot;).start();

            //lamda表达式
            new Thread(()-&gt;{
                for (int j = 0; j &lt; 40; j++) {
                        ticket.saleTicket();
                }
            },i+&quot;售票员&quot;).start();
        }
    }
}
class Ticket{
    private int ticketNum=30;//票数
    private Lock lock=new ReentrantLock();

    public void saleTicket(){
        lock.lock();
        try {
            if(this.ticketNum &gt; 0){
                System.out.println(Thread.currentThread().getName()+&quot;卖出第&quot;+ticketNum--+&quot;票，还剩下&quot;+ticketNum+&quot;票&quot;);
            }
        } finally {
            lock.unlock();
        }
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h2 id="二-复习lambda表达式"><a href="#二-复习lambda表达式" class="header-anchor">#</a> 二.复习lambda表达式</h2> <blockquote><p>条件：接口必须只有一个方法</p> <p>2.1.口诀：拷贝小括号，写死右箭头，落地大括号</p> <p>2.2 @FunctionalInterface 表示是函数式接口，只允许一个方法的定义</p> <p>2.3 default  可以使接口有实现方法
2.4 静态方法实现</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

/**
 * lambda表达式练习
 */
public class LambdaTest {
    public static void main(String[] args) {
//        Foo foo=new Foo() {
//            @Override
//            public void div() {
//                System.out.println(&quot;匿名内部类写法&quot;);
//            }
//        };
//        foo.div();

        Foo foo=()-&gt;{
            System.out.println(&quot;lambda表达式写法&quot;);
        };
        foo.div();
        foo.mv();
        foo.mv1();
        Foo.staticTest();
        Foo.staticTest1();
    }
}
//表示该接口是函数式接口
@FunctionalInterface
interface Foo{
    public void div();
    default void mv(){
        System.out.println(&quot;我是默认的方法&quot;);
    }
    default void mv1(){
        System.out.println(&quot;我也是默认的方法&quot;);
    }
    public static void staticTest(){
        System.out.println(&quot;我是静态的方法&quot;);
    }
    public static void staticTest1(){
        System.out.println(&quot;我也是静态的方法&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><strong>强调</strong>：java的接口可以有实现方法吗？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>jdk1.8之前不可以，jdk1.8以后支持，通过default关键字实现
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="三-生产者消费者模式"><a href="#三-生产者消费者模式" class="header-anchor">#</a> 三.生产者消费者模式</h2> <blockquote><p>口诀：</p> <ul><li>1、线程操作资源类</li> <li>2、若有横向通知，判断--干活--通知</li> <li>3、线程交互中，必须要防止多线程的虚假唤醒，也即（判断只用while，不能用f）</li> <li>4、需要顺序则用标志位</li></ul></blockquote> <p>题目：现在两个线程，可以操作初始值为零的一个变量，实现一个线程对该变量加扪，一个线程对该变量减1，实现交替，来10轮，变量初始值为零。</p> <h3 id="_3-1-wait、notify的使用"><a href="#_3-1-wait、notify的使用" class="header-anchor">#</a> 3.1.Wait、notify的使用</h3> <p>使用Wait、notify进行交互，典型生产者消费者模式：</p> <blockquote><p>Wait：释放CPU</p> <p>notify：通知其他线程</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

/**
 * Wait、notify实现生产者消费者模式:
 * 口诀：   判断/干活/通知
 *
 * 题目：现在两个线程，可以操作初始值为零的一个变量，
 * 实现一个线程对该变量加扪，一个线程对该变量减1，
 * 实现交替，来10轮，变量初始值为零。
 */
public class ThreadWaitNotifyDemo {
    public static void main(String[] args) {
        Num num=new Num();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                num.incrNum();//加1
            }
        },&quot;A&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                num.decrNum();//-1
            }
        },&quot;B&quot;).start();
    }
}
class Num{
    private int num=0;
    private Object object=new Object();

    public void incrNum(){
        synchronized(object){
            if(num!=0){//等于1，则释放CPU
                try {
                    object.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                    System.out.println(&quot;异常出错&quot;);
                }
            }
            num++;
            System.out.println(Thread.currentThread().getName()+&quot;----&gt;&quot;+num);
            //通知别人
            object.notifyAll();
        }
    }
    public void decrNum(){
        synchronized(object){
            if(num == 0){//等于0，则释放CPU
                try {
                    object.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                    System.out.println(&quot;异常出错&quot;);
                }
            }
            num--;
            System.out.println(Thread.currentThread().getName()+&quot;----&gt;&quot;+num);
            //通知别人
            object.notifyAll();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p><strong>存在的问题：由于线程间的交互，线程有虚假唤醒操作，导致结果不一致；比如把线程换成四个就出现问题</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    public void incrNum(){
        synchronized(object){
            if(num!=0){//等于1，则释放CPU
         		//线程有可能走到这儿之后被中断，再回来时间，可能num已经++了，就可能导致问题
                try {
                    object.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                    System.out.println(&quot;异常出错&quot;);
                }
            }
            num++;
            System.out.println(Thread.currentThread().getName()+&quot;----&gt;&quot;+num);
            //通知别人
            object.notifyAll();
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>正确代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

/**
 * Wait、notify实现生产者消费者模式:
 * 口诀：   判断/干活/通知
 *
 * 题目：现在两个线程，可以操作初始值为零的一个变量，
 * 实现一个线程对该变量加扪，一个线程对该变量减1，
 * 实现交替，来10轮，变量初始值为零。
 */
public class ThreadWaitNotifyDemo {
    public static void main(String[] args) {
        Num num=new Num();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                num.incrNum();//加1
            }
        },&quot;A&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                num.decrNum();//-1
            }
        },&quot;B&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                num.incrNum();//加1
            }
        },&quot;C&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                num.decrNum();//-1
            }
        },&quot;D&quot;).start();
    }
}
class Num{
    private int num=0;
    private Object object=new Object();

    public void incrNum(){
        synchronized(object){
            while (num!=0){//等于1，则释放CPU
                try {
                    object.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                    System.out.println(&quot;异常出错&quot;);
                }
            }
            num++;
            System.out.println(Thread.currentThread().getName()+&quot;----&gt;&quot;+num);
            //通知别人
            object.notifyAll();
        }
    }
    public void decrNum(){
        synchronized(object){
            while (num == 0){//等于0，则释放CPU
                try {
                    object.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                    System.out.println(&quot;异常出错&quot;);
                }
            }
            num--;
            System.out.println(Thread.currentThread().getName()+&quot;----&gt;&quot;+num);
            //通知别人
            object.notifyAll();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><h3 id="_3-2-lock、condition的使用"><a href="#_3-2-lock、condition的使用" class="header-anchor">#</a> 3.2.lock、Condition的使用</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>//新版写法
class Num{
    private int num=0;
    private Lock lock=new ReentrantLock();
    private Condition condition=lock.newCondition();

    public void incrNum(){
        lock.lock();
        try {
            //判断
            while (num != 0){
                condition.await();
            }
            //干活
            num++;
            System.out.println(Thread.currentThread().getName()+&quot;-----&gt;&gt;&gt;&quot;+num);
            //通知
            condition.signalAll();
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }

    public void decrNum(){
        lock.lock();
        try {
            //判断
            while (num == 0){
                condition.await();
            }
            //干活
            num--;
            System.out.println(Thread.currentThread().getName()+&quot;-----&gt;&gt;&gt;&quot;+num);
            //通知
            condition.signalAll();
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="四-lock、condition实现精准通知"><a href="#四-lock、condition实现精准通知" class="header-anchor">#</a> 四.Lock、condition实现精准通知</h2> <p>题目升级：ABC三个线程，A打印五次，B打印10次，C打印15次,顺序为Abc，打印10轮</p> <h3 id="_4-1-使用wait、notify实现"><a href="#_4-1-使用wait、notify实现" class="header-anchor">#</a> 4.1.使用wait、notify实现</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wcy<span class="token punctuation">.</span>juc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 题目：
 * ABC三个线程，A打印五次，B打印10次，C打印15次,顺序为Abc   打印10轮
 * 口径
 * 1、线程操作资源类
 * 2、若有横向通知，判断--干活--通知
 * 3、线程交互中，必须要防止多线程的虚假唤醒，也即（判断只用while，不能用f）
 * 4、需要顺序则用标志位
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadConditionDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SysNum</span> sysNum<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SysNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sysNum<span class="token punctuation">.</span><span class="token function">print5</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sysNum<span class="token punctuation">.</span><span class="token function">print10</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sysNum<span class="token punctuation">.</span><span class="token function">print15</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SysNum</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> object<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print5</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">!=</span> number<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    object<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不是A线程执行</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;-----&gt;&gt;&gt;&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            number<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
            object<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print10</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">!=</span> number<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    object<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不是B线程执行</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;-----&gt;&gt;&gt;&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            number<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
            object<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print15</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">!=</span> number<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    object<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不是C线程执行</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;-----&gt;&gt;&gt;&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            number<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
            object<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p><strong>优化</strong></p> <p><strong>上方是三个方法实现，可以用一个方法实现：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

/**
 * 题目：
 * ABC三个线程，A打印五次，B打印10次，C打印15次,顺序为Abc   打印10轮
 * 口径
 * 1、线程操作资源类
 * 2、若有横向通知，判断--干活--通知
 * 3、线程交互中，必须要防止多线程的虚假唤醒，也即（判断只用while，不能用f）
 * 4、需要顺序则用标志位
 */
public class ThreadConditionDemo {
    public static void main(String[] args) {
        SysNum sysNum=new SysNum();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                sysNum.print(1);
            }
        },&quot;A&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                sysNum.print(2);
            }
        },&quot;B&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                sysNum.print(3);
            }
        },&quot;C&quot;).start();
    }
}

class SysNum{
    private int number=1;
    private Object object=new Object();

    public void print(int num){
        synchronized (object){
            //判断
            while (num != number){
                try {
                    object.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            //干活
            for (int i = 0; i &lt; 5*num; i++) {
                System.out.println(Thread.currentThread().getName()+&quot;-----&gt;&gt;&gt;&quot;+i);
            }
            //通知
            number=(number==3)?1:number+1;//为C的时候应改为A
            object.notifyAll();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="_4-2-使用lock、condition实现"><a href="#_4-2-使用lock、condition实现" class="header-anchor">#</a> 4.2.使用lock、condition实现</h3> <blockquote><p>定义：Lock 、condition实现</p> <p>private Lock lock=new ReentrantLock();
private Condition condition1=lock.newCondition();
private Condition condition2=lock.newCondition();
private Condition condition3=lock.newCondition();</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

/**
 * 题目：
 * ABC三个线程，A打印五次，B打印10次，C打印15次,顺序为Abc 打印10轮
 * 口径
 * 1、线程操作资源类
 * 2、若有横向通知，判断--干活--通知
 * 3、线程交互中，必须要防止多线程的虚假唤醒，也即（判断只用while，不能用f）
 * 4、需要顺序则用标志位
 */
public class ThreadConditionDemo {
    public static void main(String[] args) {
        PrintNum printNum=new PrintNum();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                printNum.print5();
            }
        },&quot;A&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                printNum.print10();
            }
        },&quot;B&quot;).start();
        new Thread(()-&gt;{
            for (int i = 0; i &lt; 10; i++) {
                printNum.print15();
            }
        },&quot;C&quot;).start();
    }
}

class PrintNum{
    private int number=1;//1:A  2:B  3:C
    private Lock lock=new ReentrantLock();
    private Condition condition1=lock.newCondition();
    private Condition condition2=lock.newCondition();
    private Condition condition3=lock.newCondition();

    public void print5(){
        lock.lock();
        try {
            //判断
            while (number != 1){
                condition1.await();//A等待
            }
            //干活
            for (int i = 0; i &lt; 5; i++) {
                System.out.println(Thread.currentThread().getName()+&quot;-----&gt;&gt;&gt;&quot;+i);
            }
            //通知
            number=2;//B开始干活
            condition2.signal();//通知B
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }

    public void print10(){
        lock.lock();
        try {
            //判断
            while (number != 2){
                condition2.await();//A等待
            }
            //干活
            for (int i = 0; i &lt; 10; i++) {
                System.out.println(Thread.currentThread().getName()+&quot;-----&gt;&gt;&gt;&quot;+i);
            }
            //通知
            number=3;//B开始干活
            condition3.signal();//通知B
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }

    public void print15(){
        lock.lock();
        try {
            //判断
            while (number != 3){
                condition3.await();//A等待
            }
            //干活
            for (int i = 0; i &lt; 15; i++) {
                System.out.println(Thread.currentThread().getName()+&quot;-----&gt;&gt;&gt;&quot;+i);
            }
            //通知
            number=1;//B开始干活
            condition1.signal();//通知B
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><p><strong>优化：</strong></p> <p>上面使用了三个方法，其实这三个方法都是差不多的，所以改写成一个：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wcy<span class="token punctuation">.</span>juc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 题目：
 * ABC三个线程，A打印五次，B打印10次，C打印15次,顺序为Abc   打印10轮
 * 口径
 * 1、线程操作资源类
 * 2、若有横向通知，判断--干活--通知
 * 3、线程交互中，必须要防止多线程的虚假唤醒，也即（判断只用while，不能用f）
 * 4、需要顺序则用标志位
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadConditionDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PrintNum</span> printNum<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PrintNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                printNum<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                printNum<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                printNum<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PrintNum</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//1:A  2:B  3:C</span>
    <span class="token keyword">private</span> <span class="token class-name">Lock</span> lock<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> condition1<span class="token operator">=</span>lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> condition2<span class="token operator">=</span>lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> condition3<span class="token operator">=</span>lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span><span class="token punctuation">[</span><span class="token punctuation">]</span> conditions<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Condition</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>condition1<span class="token punctuation">,</span>condition2<span class="token punctuation">,</span>condition3<span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     *
     * @param num 线程   1:A  2:B  3:C
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span><span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> num<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//当不是自己处理 则释放该CPU</span>
                conditions<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数组0开始</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//干活</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token operator">*</span>num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;----&gt;&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//通知</span>
            number<span class="token operator">=</span> <span class="token punctuation">(</span>number<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">1</span><span class="token operator">:</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//通知下一个</span>
            conditions<span class="token punctuation">[</span>number<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数组从0开始的 所以-1</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h2 id="五-8锁"><a href="#五-8锁" class="header-anchor">#</a> 五.8锁</h2> <p><strong>静态同步方法和同步方法锁的目标不一样，互不干扰，静态同步方法锁的是class、同步方法锁的是对象（实例）；</strong></p> <blockquote><p>题目:多线程8锁
1.标准访问，请问先打印邮件还是短信?
2.邮件方法暂停4秒钟，请问先打印邮件还是短信?
3.新增一个普通方法hello()，请问先打印邮件还是hello ?
4.两部手机，请问先打印邮件还是短信?
5.两个静态同步方法，同一部手机，请问先打印邮件还是短信?
6.两个静态同步方法，2部手机，请问先打印邮件还是短信?
7.1个普通同步方法,1个静态同步方法，1部手机，请问先打印邮件还是短信?
8.1个普通同步方法,1个静态同步方法，2部手机，请问先打印邮件还是短信?</p></blockquote> <p>代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.TimeUnit;

/**
 * 线程8锁
 *
 * 1.标准访问，请问先打印邮件还是短信?
 * 2.邮件方法暂停4秒钟，请问先打印邮件还是短信?
 * 3.新增一个普通方法hello()，请问先打印邮件还是hello ?
 * 4.两部手机，请问先打印邮件还是短信?
 * 5.两个静态同步方法，同一部手机，请问先打印邮件还是短信?
 * 6.两个静态同步方法，2部手机，请问先打印邮件还是短信?
 * 7.1个普通同步方法,1个静态同步方法，1部手机，请问先打印邮件还是短信?
 * 8.1个普通同步方法,1个静态同步方法，2部手机，请问先打印邮件还是短信?
 */
public class Thread8 {
    public static void main(String[] args) throws Exception {
        Phone phone=new Phone();
        Phone phone1=new Phone();
        new Thread(()-&gt;{
            phone.sendEmail();
        },&quot;A&quot;).start();

        TimeUnit.MILLISECONDS.sleep(1);//休眠1毫秒秒钟
        new Thread(()-&gt;{
//      2      phone.sendMsg();
//    3        phone.hello();
//     4       phone1.sendMsg();
//     5       phone.sendMsg();
//      6      phone1.sendMsg();
            phone.sendMsg();
//            phone1.sendMsg();
        },&quot;B&quot;).start();
    }
}
class Phone{
    private static Object object=new Object();
    public synchronized static void sendEmail(){
            try {
                TimeUnit.SECONDS.sleep(1);//休眠4秒
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(&quot;sendEmail&quot;);
    }
    public synchronized void sendMsg(){
            System.out.println(&quot;sendMsg&quot;);
    }
    public void hello(){
        System.out.println(&quot;hello&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>题解：</p> <blockquote><p>1.先打印邮件--标准访问</p> <p>2.先打印邮件，sleep并不释放锁，同一个对象；</p> <p>3.先打印hello，hello方法无锁，可以直接输出；</p> <p>4.先打印短信，两个对象，两把锁，互不干扰，锁的对象；</p> <p>5.先打印邮件，静态同步方法，锁的是class类，一把锁，邮件拿到锁不释放；</p> <p>6.先打印邮件，静态同步方法，锁的是class类，一把锁，邮件拿到锁不释放；</p> <p>7、8.先打印短信，锁对象不同</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715162223617.png" alt="image-20210715162223617"></p> <h2 id="六-list"><a href="#六-list" class="header-anchor">#</a> 六.List</h2> <p>并发操作集合，常见异常<strong>java.util.ConcurrentModificationException</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715170014531.png" alt="image-20210715170014531"></p> <p>list集合并发使用：推荐使用CopyOnWriteArrayList，JUC下面的并发集合类</p> <blockquote><ul><li>1.new Vector&lt;&gt;();  不提倡，其实就是ArrayList&lt;&gt;加了synchronized</li> <li>2.Collections.synchronizedList(new ArrayList&lt;&gt;());</li> <li>3.new CopyOnWriteArrayList&lt;&gt;();</li></ul></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.List;
import java.util.UUID;
import java.util.concurrent.CopyOnWriteArrayList;

/**
 * List并发集合类demo
 * 并发问题：
 * new ArrayList&lt;&gt;();不安全
 *
 * 解决办法：
 * 1.new Vector&lt;&gt;();  不提倡，其实就是ArrayList&lt;&gt;加了synchronized
 * 2.Collections.synchronizedList(new ArrayList&lt;&gt;());
 * 3.new CopyOnWriteArrayList&lt;&gt;();
 *
 */
public class ThreadListDemo {
    public static void main(String[] args) {
//        List&lt;String&gt; list=new ArrayList&lt;&gt;();
//        List&lt;String&gt; list=new Vector&lt;&gt;();
//        List&lt;String&gt; list= Collections.synchronizedList(new ArrayList&lt;&gt;());
        List&lt;String&gt; list=new CopyOnWriteArrayList&lt;&gt;();
        for (int i = 0; i &lt; 30; i++) {
            new Thread(()-&gt;{
                list.add(UUID.randomUUID().toString().substring(0,8));
                System.out.println(list);
            },String.valueOf(i)).start();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_6-1-arraylist"><a href="#_6-1-arraylist" class="header-anchor">#</a> 6.1.ArrayList</h3> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715181937868.png" alt="image-20210715181937868"></p> <h3 id="_6-2-collections-synchronizedlist-new-arraylist"><a href="#_6-2-collections-synchronizedlist-new-arraylist" class="header-anchor">#</a> 6.2.Collections.synchronizedList(new ArrayList&lt;&gt;());</h3> <p>底层通过synchonized实现的，遍历未加锁，写删加锁</p> <h3 id="_6-3-copyonwritearraylist"><a href="#_6-3-copyonwritearraylist" class="header-anchor">#</a> 6.3.CopyOnWriteArrayList</h3> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715182049079.png" alt="image-20210715182049079"></p> <blockquote><p>写时复制
Copyonwrite容器即写时复制的容器。往一个容器添加元素的时候，不直接往当前容器object[]添加，而是先将当前容涨object[]进行icopy,复制出一个新的容器object[ ] newElements，然后新的容器object[ ] newELements里添加元素，添加完元素之后，
再将原容器的引用指向新的容器setArray(newELements);。这样做的好处是可以对欢CopyOnwrite容器进行并发的读，而不需要加锁，因为当前容器不会添加任何元素。所以copyonerite容器也是一种读写分离的思想，读和写不同的容器。</p></blockquote> <h2 id="七-set"><a href="#七-set" class="header-anchor">#</a> 七.Set</h2> <h3 id="_7-1-hashset"><a href="#_7-1-hashset" class="header-anchor">#</a> 7.1.HashSet</h3> <blockquote><p>hashSet底层是hashMap：key是值，value是一个object常量</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715190336059.png" alt="image-20210715190336059"></p> <h3 id="_7-2-collections-synchronizedset-new-hashset"><a href="#_7-2-collections-synchronizedset-new-hashset" class="header-anchor">#</a> 7.2.Collections.synchronizedSet(new HashSet&lt;&gt;());</h3> <p>底层通过synchonized实现的，遍历未加锁，写删加锁</p> <h3 id="_7-3-copyonwritearrayset"><a href="#_7-3-copyonwritearrayset" class="header-anchor">#</a> 7.3.CopyOnWriteArraySet</h3> <p>底层的add方法：首先获取原数组，调用indexOf方法判断数组中是否已有，有则不添加，否则进入方法addIfAbsent</p> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715190856915.png" alt="image-20210715190856915"></p> <p>走到了CopyOnWriteArrayList的addIfAbsent</p> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210715191108253.png" alt="image-20210715191108253"></p> <h2 id="八-map"><a href="#八-map" class="header-anchor">#</a> 八.Map</h2> <h3 id="_8-1-hashmap"><a href="#_8-1-hashmap" class="header-anchor">#</a> 8.1.HashMap</h3> <p>底层数组+链表+红黑树，长度为8链表变为红黑树，为6则红黑树变为链表；</p> <p>扩容机制为原来的两倍；</p> <p>hashMap的负载因子为0.75，可以修改，但是0.75使得hash冲突最小；</p> <p>HashMap的hash值通过高16位异或低16位，一旦有一位发送变化，hash值都会不同；</p> <h3 id="_8-2-hashtable"><a href="#_8-2-hashtable" class="header-anchor">#</a> 8.2.HashTable</h3> <p>其实就是HashMap每个方法加上了synchronized</p> <h3 id="_8-3-collections-synchronizedmap-new-hashmap-string-string"><a href="#_8-3-collections-synchronizedmap-new-hashmap-string-string" class="header-anchor">#</a> 8.3.Collections.synchronizedMap(new HashMap&lt;String,String&gt;());</h3> <p>遍历未加锁，修改加锁</p> <h3 id="_8-4-new-concurrenthashmap"><a href="#_8-4-new-concurrenthashmap" class="header-anchor">#</a> 8.4.new ConcurrentHashMap&lt;&gt;();</h3> <h2 id="九-callable"><a href="#九-callable" class="header-anchor">#</a> 九.Callable</h2> <h3 id="_9-1-callable和runable的区别"><a href="#_9-1-callable和runable的区别" class="header-anchor">#</a> 9.1.callable和runable的区别：</h3> <ol><li>前者为call方法，后者为run方法</li> <li>前者有抛出异常，后者无</li> <li>前者有返回值，后者无</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210721112331403.png" alt="image-20210721112331403"></p> <h3 id="_9-2-使用callable"><a href="#_9-2-使用callable" class="header-anchor">#</a> 9.2.使用callable</h3> <blockquote><p>1.get()方法会阻塞当前线程，所以get()方法一般放到最后</p> <p>2.同一个FutureTask任务，即使多个线程也只会执行一次，有缓存；类似于：老师上课，喊同学去买水，第一次可以，第二次再交这位同学去买水就过分了；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>FutureTask futureTask=new FutureTask(new MyThread());
new Thread(futureTask,&quot;A&quot;).start();
new Thread(futureTask,&quot;B&quot;).start();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;

/**
 * 创建线程的第三种方式：
 * 实现callable接口
 */
public class CallableDemo {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        /**
         * 利用多态性=》由于new Thread()的构造方法只支持传入Runnable接口，
         * 找到Runnable的子接口FutureTask
         * FutureTask的构造方法支持传入Callable
         */
        FutureTask futureTask=new FutureTask(new MyThread());
        //启动线程
        new Thread(futureTask,&quot;A&quot;).start();
        new Thread(futureTask,&quot;B&quot;).start();
        System.out.println(futureTask.get());//获取线程返回的数据  会阻塞当前线程
    }
}

class MyThread implements Callable{

    @Override
    public Object call() throws Exception {
        System.out.println(&quot;*****com进来了****&quot;);
        return 1024;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="十-等待多个子线程完成了-主线程再后续执行"><a href="#十-等待多个子线程完成了-主线程再后续执行" class="header-anchor">#</a> 十.等待多个子线程完成了，主线程再后续执行</h2> <h3 id="_1-countdownlatch-倒计时锁"><a href="#_1-countdownlatch-倒计时锁" class="header-anchor">#</a> 1.CountDownLatch(倒计时锁)</h3> <blockquote><p>CountDownLatch主要有两个方法，当一个或多个线程调用await方法时，这些线程会阻塞。</p> <p>其它线程调用countDown方法会将计数器减1(调用countDown方法的线程不会阻塞)，
当计数器的值变为o时，因await方法阻塞的线程会被唤醒，继续执行</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.CountDownLatch;

/**
 * 线程等待：
 * 比如：等待6个子线程完成了，主线程再后续执行
 * 解决：CountDownLatch：子线程完成一次调用一次countDownLatch.countDown()进行减一操作，最后通过await等待获取结果
 */
public class CountDownLatchDemo {
    public static void main(String[] args) throws InterruptedException {
        CountDownLatch countDownLatch=new CountDownLatch(6);
        for (int i = 1; i &lt;= 6; i++) {
            new Thread(()-&gt;{
                System.out.println(Thread.currentThread().getName()+&quot;同学离开&quot;);
                countDownLatch.countDown();//子线程完成一次减一
            },i+&quot;&quot;).start();
        }
        countDownLatch.await();
        System.out.println(&quot;主线程结束&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_2-cyclicbarrier-计数器"><a href="#_2-cyclicbarrier-计数器" class="header-anchor">#</a> 2.CyclicBarrier（计数器）</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>    public static void main(String[] args) throws InterruptedException {
        CyclicBarrier barrier=new CyclicBarrier(7,()-&gt; System.out.println(&quot;集起七颗龙珠&quot;));
        for (int i = 0; i &lt; 7; i++) {
            int index=i;
            new Thread(()-&gt;{
                System.out.println(&quot;第&quot;+index+&quot;颗龙珠&quot;);
                try {
                    barrier.await();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } catch (BrokenBarrierException e) {
                    e.printStackTrace();
                }
            },&quot;&quot;+i).start();
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="十一-semaphore信号量"><a href="#十一-semaphore信号量" class="header-anchor">#</a> 十一.Semaphore信号量</h2> <blockquote><p>在信号量上我们定义两种操作:</p> <ul><li><p>acquire(获取）当一个线程调用acquire操作时，它要么通过成功获取信号量（信号量减1），
要么一直等下去，直到有线程释放信号量，或超时。</p></li> <li><p>release（释放）实际上会将信号量的值加1，然后唤醒等待的线程</p> <p>信号量主要用于两个目的，一个是用于<strong>多个共享资源的互斥使用</strong>，另一个<strong>用于并发线程数的控制</strong>。</p></li></ul></blockquote> <p><strong>Semaphore semaphore=new Semaphore(1);其实就是synchronized，相当与锁</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.Semaphore;
import java.util.concurrent.TimeUnit;

/**
 * 多个线程访问多个资源
 * 假设：六个小车抢占三个停车位
 * Semaphore 保证了资源只有三份，随便怎么抢
 */
public class SemaphoreDemo {
    public static void main(String[] args) {
        Semaphore semaphore=new Semaphore(3);//定义了三个资源
        for (int i = 0; i &lt; 6; i++) {
            new Thread(()-&gt;{
                try {
                    semaphore.acquire();//抢占资源
                    System.out.println(Thread.currentThread().getName()+&quot;抢到了停车位&quot;);
                    TimeUnit.SECONDS.sleep(1);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }finally {
                    semaphore.release();//释放资源
                    System.out.println(Thread.currentThread().getName()+&quot;离开了停车位&quot;);
                }
            },i+&quot;&quot;).start();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="十二-readwritelock-读写锁"><a href="#十二-readwritelock-读写锁" class="header-anchor">#</a> 十二.ReadWriteLock(读写锁)</h2> <ol><li>读读不加锁</li> <li>读写枷锁</li> <li>写写加锁</li></ol> <blockquote><p>手写一个简单的缓存工具</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.locks.ReadWriteLock;
import java.util.concurrent.locks.ReentrantReadWriteLock;

/**
 * 读写锁
 *  * 多个线程同时读一个资源类没有任何问题，所以为了满足并发量，读取共享资源应该可以同时进行。
 *  * 但是，如果有一个线程想去写共享资源来，就不应该再有其他线程可以对改资源进行读或写
 *  * 小总结：
 *  *      读-读能共存
 *  *      读-写不能共存
 *  *      写-写不能共存
 */
public class ReadWriteLockDemo {
    public static void main(String[] args) {
        MyCache myCache=new MyCache();
        for (int i = 0; i &lt; 5; i++) {
            final int item=i;
            new Thread(()-&gt;{
                myCache.put(item+&quot;&quot;,item);
            },i+&quot;&quot;).start();
        }
        for (int i = 0; i &lt; 5; i++) {
            final int item=i;
            new Thread(()-&gt;{
                myCache.get(item+&quot;&quot;);
            },i+&quot;&quot;).start();
        }
    }
}
class MyCache{
    //volatile:，保证可见性，不保证原子性，一个线程修改后，通知更新
    private volatile Map&lt;String,Object&gt; map=new HashMap&lt;&gt;();
    private ReadWriteLock lock=new ReentrantReadWriteLock();//读写锁

    public void put(String key,Object value){
        lock.writeLock().lock();//获取写锁
        try {
            System.out.println(Thread.currentThread().getName()+&quot;---写入数据准备&quot;);
            map.put(key,value);
            System.out.println(Thread.currentThread().getName()+&quot;---写入数据完成&quot;+key);
        }finally {
            lock.writeLock().unlock();//释放写锁
        }
    }

    public void get(String key){
        lock.readLock().lock();
        try {
            System.out.println(Thread.currentThread().getName()+&quot;---读取数据准备&quot;);
            Object o = map.get(key);
            System.out.println(Thread.currentThread().getName()+&quot;---读取数据完成&quot;+o);
        }finally {
            lock.readLock().unlock();
        }
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h2 id="十三-blokingqueue阻塞队列种类"><a href="#十三-blokingqueue阻塞队列种类" class="header-anchor">#</a> 十三.BlokingQueue阻塞队列种类</h2> <h3 id="_13-1-阻塞队列"><a href="#_13-1-阻塞队列" class="header-anchor">#</a> 13.1.阻塞队列：</h3> <blockquote><p>当队列为空的时候，从队列中取出元素会阻塞队列；</p> <p>当队列是满的时候，从队列添加元素会阻塞队列；</p></blockquote> <h3 id="_13-2-阻塞队列的种类"><a href="#_13-2-阻塞队列的种类" class="header-anchor">#</a> 13.2.阻塞队列的种类：</h3> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210722111227857.png" alt="image-20210722111227857"></p> <h3 id="_13-3-阻塞队列的操作"><a href="#_13-3-阻塞队列的操作" class="header-anchor">#</a> 13.3.阻塞队列的操作：</h3> <table><thead><tr><th>方法类型</th> <th>抛出异常</th> <th>特殊值</th> <th>阻塞</th> <th>超时</th></tr></thead> <tbody><tr><td>插入</td> <td>add(e)</td> <td>offer(e)</td> <td>put(e)</td> <td>offer(e.time,unit)</td></tr> <tr><td>移除</td> <td>remore()</td> <td>poll()</td> <td>take()</td> <td>poll(time,unilt)</td></tr> <tr><td>检查（获取头元素）</td> <td>element()</td> <td>peek()</td> <td>不可用</td> <td>不可用</td></tr></tbody></table> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210722112203068.png" alt="image-20210722112203068"></p> <h2 id="十四-了解java的值传递"><a href="#十四-了解java的值传递" class="header-anchor">#</a> 十四.了解java的值传递</h2> <ol><li><p>基本数据类型是拷贝一份过去</p></li> <li><p>引用类型，传递过去的一份，但是大家是公用这一份的。</p> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210722142147954.png" alt="image-20210722142147954"></p></li> <li><p>字符串注意有常量池不会改变；</p></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTransferValue</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeValue1</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
        age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeValue2</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span><span class="token punctuation">{</span>
        person<span class="token punctuation">.</span><span class="token function">setPersonName</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeValue3</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
        str <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TestTransferValue</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestTransferValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">changeValue1</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;age----&quot;</span><span class="token operator">+</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//20</span>

        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">changeValue2</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;personName-------&quot;</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">getPersonName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//xxx</span>

        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
        test<span class="token punctuation">.</span><span class="token function">changeValue3</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;String-----&quot;</span><span class="token operator">+</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//abc</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="十五-线程池"><a href="#十五-线程池" class="header-anchor">#</a> 十五.线程池</h2> <h3 id="_1-为什么使用多线程"><a href="#_1-为什么使用多线程" class="header-anchor">#</a> 1.为什么使用多线程？</h3> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210722142754631.png" alt="image-20210722142754631"></p> <h3 id="_2-线程池类图"><a href="#_2-线程池类图" class="header-anchor">#</a> 2.线程池类图</h3> <p>可以与List、Lists、Collections、Collection来类比记忆。</p> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210722144113724.png" alt="image-20210722144113724"></p> <h3 id="_3-线程池工具类-阿里巴巴强制说明不准使用-需自己new"><a href="#_3-线程池工具类-阿里巴巴强制说明不准使用-需自己new" class="header-anchor">#</a> 3.线程池工具类（阿里巴巴强制说明不准使用，需自己new）</h3> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/20200709145729530.png" alt="在这里插入图片描述"></p> <h4 id="_1-executors-newfixedthreadpool-5"><a href="#_1-executors-newfixedthreadpool-5" class="header-anchor">#</a> 1.Executors.newFixedThreadPool(5);</h4> <p>长度固定的线程池</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    public static void main(String[] args) {
        ExecutorService executorService=null;
        try {
            executorService = Executors.newFixedThreadPool(5);
            for (int i = 0; i &lt; 10; i++) {
                executorService.execute(()-&gt;{
                    System.out.println(Thread.currentThread().getName()+&quot;处理业务&quot;);
                });
            }
        }finally {
            executorService.shutdown();//关闭线程池
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>        return new ThreadPoolExecutor(nThreads, nThreads,
                                      0L, TimeUnit.MILLISECONDS,
                                      new LinkedBlockingQueue&lt;Runnable&gt;());
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-executors-newsinglethreadexecutor"><a href="#_2-executors-newsinglethreadexecutor" class="header-anchor">#</a> 2.Executors.newSingleThreadExecutor();</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>        return new FinalizableDelegatedExecutorService
            (new ThreadPoolExecutor(1, 1,
                                    0L, TimeUnit.MILLISECONDS,
                                    new LinkedBlockingQueue&lt;Runnable&gt;()));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一次只执行一个线程</p> <h4 id="_3-executors-newcachedthreadpool"><a href="#_3-executors-newcachedthreadpool" class="header-anchor">#</a> 3.Executors.newCachedThreadPool();</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>        return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                      60L, TimeUnit.SECONDS,
                                      new SynchronousQueue&lt;Runnable&gt;());
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>动态执行线程</p> <blockquote><p>底层都是new ThreadPoolExecutro()实现的</p></blockquote> <h3 id="_4-线程池七大参数"><a href="#_4-线程池七大参数" class="header-anchor">#</a> 4.线程池七大参数</h3> <p>源码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    public ThreadPoolExecutor(int corePoolSize,
                              int maximumPoolSize,
                              long keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue,
                              ThreadFactory threadFactory,
                              RejectedExecutionHandler handler) {
        if (corePoolSize &lt; 0 ||
            maximumPoolSize &lt;= 0 ||
            maximumPoolSize &lt; corePoolSize ||
            keepAliveTime &lt; 0)
            throw new IllegalArgumentException();
        if (workQueue == null || threadFactory == null || handler == null)
            throw new NullPointerException();
        this.corePoolSize = corePoolSize;
        this.maximumPoolSize = maximumPoolSize;
        this.workQueue = workQueue;
        this.keepAliveTime = unit.toNanos(keepAliveTime);
        this.threadFactory = threadFactory;
        this.handler = handler;
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol><li>corePoolSize：核心线程数（线程池中常驻的核心线程数）</li> <li>maximumPoolSize：最大线程数，线程池中最大能容纳的线程数，<strong>当核心线程数、队列满了，开启线程</strong></li> <li>keepAliveTime：时间长短</li> <li>unit：时间单位，配合keepAliveTime一起使用，用于回收核心线程数</li> <li>workQueue：阻塞队列，<strong>当核心线程数满了，放到队列中</strong></li> <li>threadFactory：线程工厂（默认）</li> <li>RejectedExecutorHandler：拒绝策略：<strong>当核心线程数、最大线程数、队列满了执行</strong></li></ol> <h3 id="_5-线程池的执行流程"><a href="#_5-线程池的执行流程" class="header-anchor">#</a> 5.线程池的执行流程</h3> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/20200709121721658.png" alt="img"></p> <p>1、在创建了线程池后，开始等待请求。
2、当调用execute()方法添加一个请求任务时，线程池会做出如下判断:
2.1如果正在运行的线程数量小于corePoolSize，那么马上创建线程运行这个任务;
2.2如果正在运行的线程数量大于或等于corePoolSize，那么将这个任务放入队列;
2.3如果这个时候队列满了且正在运行的线程数量还小于maximumPoolSize，那么还是要创建非核心线程立刻运行这个任务;
2.4如果队列满了且正在运行的线程数量大于或等于maximumPoolSize，那么线程池会启动饱和拒绝策略来执行。
3、当一个线程完成任务时，它会从队列中取下一个任务来执行。
4、当一个线程无事可做超过一定的时间（keepAliveTime）时，线程会判断:
如果当前运行的线程数大于corePoolSize，那么这个线程就被停掉。所以线程池的所有任务完成后，它最终会收缩到corePoolSize的大小。</p> <h3 id="_6-自定义线程池"><a href="#_6-自定义线程池" class="header-anchor">#</a> 6.自定义线程池</h3> <blockquote><p>下面定义了核心线程数为2，最大线程数为5，队列长度为3的线程池，当线程数到9就会报：java.util.concurrent.RejectedExecutionException异常</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void main(String[] args) {
        ExecutorService executorService=null;
        try {
            executorService=new ThreadPoolExecutor(
                    2,
                    5,
                    2L,
                    TimeUnit.MINUTES,
                    new ArrayBlockingQueue&lt;&gt;(3),
                    Executors.defaultThreadFactory(),
                    new ThreadPoolExecutor.AbortPolicy());
            for (int i = 0; i &lt; 9; i++) {
                executorService.execute(()-&gt;{
                    try {
                        TimeUnit.SECONDS.sleep(1);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(Thread.currentThread().getName()+&quot;处理业务&quot;);
                });
            }
        }finally {
            executorService.shutdown();//关闭线程池
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_7-拒绝策略"><a href="#_7-拒绝策略" class="header-anchor">#</a> 7.拒绝策略</h3> <h4 id="_1-jdk内置四种拒绝策略"><a href="#_1-jdk内置四种拒绝策略" class="header-anchor">#</a> 1.JDK内置四种拒绝策略</h4> <ol><li><p>AbortPolicy（默认）：直接抛出RejectedExecutionException异常阻止系统正常运行</p></li> <li><p>CallerRunsPolicy：不会抛弃任务也不会抛出异常，而是把任务回退到调用者(若线程池是主线程创建，则主线程执行任务),从而降低新任务的流量。</p> <p><img src="https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210722192202681.png" alt="image-20210722192202681"></p></li> <li><p>DiscardOldestPolicy：抛弃队列中等待最久的任务，然后把当前任务加入到队列中尝试再次提交当前任务。</p></li> <li><p>DiscardPolicy：直接抛弃异常，如果允许任务丢失，这是最好的一中策略；</p></li></ol> <h4 id="_2-自定义拒绝策略"><a href="#_2-自定义拒绝策略" class="header-anchor">#</a> 2.自定义拒绝策略</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.wcy.juc;

import java.util.concurrent.*;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * 自定义线程访问策略
 */
public class MyThreadPoolExecutor {
    private ExecutorService service=null;

    public ExecutorService init(){
        if(service == null){
            this.service=new ThreadPoolExecutor(
                    2,
                    3,
                    2L,
                    TimeUnit.MINUTES,
                    new ArrayBlockingQueue&lt;&gt;(5),
                    new MyThreadPoolExecutor.MyThreadFactory(), //自定义线程工厂
                    new MyThreadPoolExecutor.MyPolicy() //自定义的拒绝策略
            );
        }
        return service;
    }

    public void destory(){
        if(this.service != null){
            this.service.shutdown();//关闭线程池
        }
    }

    /**
     * 自定义线程工厂
     */
    class MyThreadFactory implements ThreadFactory{
        private AtomicInteger account=new AtomicInteger(0);

        @Override
        public Thread newThread(Runnable r) {
            Thread t = new Thread(r);
            String threadName = MyThreadPoolExecutor.class.getSimpleName() + account.addAndGet(1);
            //System.out.println(threadName);
            t.setName(threadName);
            return t;
        }
    }

    /**
     * 自定义拒绝策略
     */
    class MyPolicy implements RejectedExecutionHandler{

        //当前任务执行到改地方 应该做什么
        @Override
        public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
            try {
                // 核心改造点，由blockingqueue的offer改成put阻塞方法
                System.out.println(&quot;*****执行线程池拒绝策略*******&quot;);
                executor.getQueue().put(r);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    public static void main(String[] args) {
        MyThreadPoolExecutor myExecutor = new MyThreadPoolExecutor();
        ExecutorService executor=myExecutor.init();//获取自定义拒绝策略的线程池
        try {
            for (int i = 0; i &lt; 10; i++) {
                executor.execute(()-&gt;{
                    System.out.println(Thread.currentThread().getName()+&quot;执行了&quot;);
                });
            }
        }finally {
            myExecutor.destory();//调用关闭线程池
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h3 id="_8-最大线程的值如何确认"><a href="#_8-最大线程的值如何确认" class="header-anchor">#</a> 8.最大线程的值如何确认？</h3> <blockquote><p>根据CPU密集型和 IO密集型的任务确认：</p> <ol><li>CPU密集型的任务，最大线程数&lt;=CPU的可用核心数。</li> <li>IO密集型的任务，最大线程数和CPU核心数没有很强的联系，根据任务量的大小和服务器的性能来设定一个值。如果平均IO任务量是100个，那么最大线程数可以设置为120，如果平均IO任务量非常大的话，那么，建议调整软件架构，采用分布式来处理吧，瓶颈已经不是什么线程池了。</li></ol></blockquote></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/wangchangyin/myBlog/edit/master/docs/01.后端/01.JUC/00.JUC笔记.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/09/22, 16:16:17</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/myBlog/pages/38be09/" class="prev">UUID唯一订单号</a></span> <span class="next"><a href="/myBlog/pages/dea0da/">java并发编程之美（笔记）</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/myBlog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/myBlog/pages/1adf94/"><div>阿里云增加虚拟内存</div></a> <span>01-27</span></dt></dl><dl><dd>02</dd> <dt><a href="/myBlog/pages/78011c/"><div>oracle锁表</div></a> <span>12-15</span></dt></dl><dl><dd>03</dd> <dt><a href="/myBlog/pages/658e4c/"><div>模式二：URL重定向传播会话</div></a> <span>12-14</span></dt></dl> <dl><dd></dd> <dt><a href="/myBlog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2452952178@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wangchangyin" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>Changyin Wang | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div><APlayer audio="" fixed="true" mini="true" autoplay="autoplay" theme="#282c34" loop="loop" order="list" preload="auto" volume="0.7" mutex="true" lrc-type="3" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div></div></div></div>
    <script src="/myBlog/assets/js/app.6034fc33.js" defer></script><script src="/myBlog/assets/js/2.ecdec458.js" defer></script><script src="/myBlog/assets/js/18.3f280d96.js" defer></script>
  </body>
</html>