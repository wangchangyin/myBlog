(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{463:function(t,e,r){"use strict";r.r(e);var s=r(8),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"过滤器、拦截器、aop切面"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#过滤器、拦截器、aop切面"}},[t._v("#")]),t._v(" 过滤器、拦截器、AOP切面")]),t._v(" "),r("p",[t._v("参考：https://www.toutiao.com/i6727212676704895499/?tt_from=mobile_qq&utm_campaign=client_share&timestamp=1611029453&app=news_article&utm_source=mobile_qq&utm_medium=toutiao_android&use_new_style=1&req_id=202101191210520101350542043D9F1870&share_token=e94ddfbf-59c0-4ae2-9c28-1b7c26964552&group_id=6727212676704895499")]),t._v(" "),r("h2",{attrs:{id:"一-过滤器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-过滤器"}},[t._v("#")]),t._v(" 一.过滤器")]),t._v(" "),r("p",[t._v("过滤器可以"),r("strong",[t._v("拦截到方法的请求和响应")]),t._v("(ServletRequest request, ServletResponse response),并对"),r("strong",[t._v("请求响应")]),t._v("做出过滤操作。")]),t._v(" "),r("blockquote",[r("p",[t._v("过滤器"),r("strong",[t._v("依赖于servlet容器")]),t._v("。在实现上，基于函数回调，它可以对几乎所有请求进行过滤，一个过滤器实例只能在"),r("strong",[t._v("容器初始化时调用一次。")])])]),t._v(" "),r("p",[t._v("使用过滤器的目的是用来"),r("strong",[t._v("做一些过滤操作")]),t._v("，获取我们想要获取的数据，比如：在过滤器中修改字符编码；在"),r("strong",[t._v("过滤器中修改HttpServletRequest的一些参数")]),t._v("，包括：过滤低俗文字、危险字符等。")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p3-tt.byteimg.com/origin/pgc-image/01f32e1b6dff4f66bffc53af821ed736?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[r("strong",[t._v("Filter随web应用的启动而启动")]),t._v("，只初始化一次，随web应用的停止而销毁。")]),t._v(" "),r("blockquote",[r("p",[t._v("1.启动服务器时加载过滤器的实例，并"),r("strong",[t._v("调用init()方法")]),t._v("来初始化实例；")]),t._v(" "),r("p",[t._v("2.每一次请求时都"),r("strong",[t._v("只调用方法doFilter()进行处理")]),t._v("；")]),t._v(" "),r("p",[t._v("3.停止服务器时"),r("strong",[t._v("调用destroy()方法")]),t._v("，销毁实例。")])]),t._v(" "),r("p",[t._v("我们再来看看doFilter方法")]),t._v(" "),r("blockquote",[r("p",[r("strong",[t._v("doFilter")]),t._v("(ServletRequest request, ServletResponse response, FilterChain chain)")])]),t._v(" "),r("p",[t._v("从参数我们看到，filter里面是能够获取到"),r("strong",[t._v("请求的参数和响应的数据")]),t._v("；但此方法是无法知道是哪一个Controller类中的哪个方法被执行。")]),t._v(" "),r("p",[t._v("还有一点需要注意的是，filter中是没法使用注入的bean的，也就是无法使用@Autowired")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p1-tt.byteimg.com/origin/pgc-image/1ea825806f9b48539e40356438d59fb2?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("上面"),r("strong",[t._v("代码注入的值为null。这是为什么呢")]),t._v("？")]),t._v(" "),r("blockquote",[r("p",[t._v("其实Spring中，web应用启动的顺序是："),r("strong",[t._v("listener->filter->servlet")]),t._v("，先初始化listener，然后再来就filter的初始化，"),r("strong",[t._v("再接着才到我们的dispathServlet的初始化")]),t._v("，因此，当我们需要在filter里注入一个注解的bean时，就会注入失败，**因为filter初始化时，注解的bean还没初始化，没法注入。")])]),t._v(" "),r("h2",{attrs:{id:"二-拦截器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-拦截器"}},[t._v("#")]),t._v(" 二.拦截器")]),t._v(" "),r("p",[t._v("依赖于web框架，在SpringMVC中就是依赖于SpringMVC框架。在实现上,"),r("strong",[t._v("基于Java的反射机制，属于面向切面编程（AOP）的一种运用")]),t._v("，就是在一个方法前，调用一个方法，或者在方法后，调用一个方法。")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p3-tt.byteimg.com/origin/pgc-image/c3ca6d39a44843c3b88534e09d525963?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("在WebMvcConfigurationSupport配置一下")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p3-tt.byteimg.com/origin/pgc-image/a94aff8bd9874a4db7b8fee2b4e1eb7d?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("执行结果")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p6-tt.byteimg.com/origin/pgc-image/e767e9004c344787a54f2f6f7e2aa6ef?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("我们发现拦截器中可以获取到Controller对象")]),t._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")])]),r("p",[t._v("object handler就是controller方法对象")]),t._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("HandlerMethod handlerMethod = (HandlerMethod)handler;\nhandlerMethod.getBean().getClass().getName(); //获取类名\nhandlerMethod.getMethod().getName(); //获取方法名\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br")])]),r("p",[t._v("但我们发现获取不到方法的参数值，这个是为什么呢？在"),r("strong",[t._v("DispatcherServlet类")]),t._v("中，方法")]),t._v(" "),r("p",[t._v("doDispatch(HttpServletRequest request, HttpServletResponse response)")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p1-tt.byteimg.com/origin/pgc-image/ddbd394664ed4b42a515ea1d8242b5bd?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[r("strong",[t._v("applyPreHandle")]),t._v("这个方法执行，就是执行的拦截器的preHandler方法，但这个过程中，controller方法没有从request中获取请求参数，组装方法参数；"),r("strong",[t._v("而是在ha.handle这个方法的时候，才会组装参数")])]),t._v(" "),r("blockquote",[r("p",[t._v("虽然没法得到方法的参数，但是可以获得IOC的bean哦。")])]),t._v(" "),r("p",[t._v("再说明一点的是"),r("strong",[t._v("postHandler方法")])]),t._v(" "),r("blockquote",[r("p",[t._v("postHandler方法的执行，当controller内部有异常，posthandler方法是不会执行的。")])]),t._v(" "),r("p",[r("strong",[t._v("afterCompletion方法")]),t._v("，不管controller内部是否有异常，都会执行此方法；此方法还会有个Exception ex这个参数；"),r("strong",[t._v("如果有异常，ex会有异常值；没有异常 此值为null")])]),t._v(" "),r("blockquote",[r("p",[t._v("注意点如果controller内部有异常，但异常被@ControllerAdvice 异常统一捕获的话，ex也会为null")])]),t._v(" "),r("h2",{attrs:{id:"三-aspect切片"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三-aspect切片"}},[t._v("#")]),t._v(" 三.Aspect切片")]),t._v(" "),r("p",[t._v("AOP操作可以对操作进行横向的拦截,最大的优势在于他可以"),r("strong",[t._v("获取执行方法的参数")]),t._v(",对方法进行统一的处理。常见"),r("strong",[t._v("使用日志,事务,请求参数安全验证")]),t._v("等")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p6-tt.byteimg.com/origin/pgc-image/977d65b42ec445418be9033b45bcc660?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("上面的代码中，我们是可以获取方法的参数的")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p6-tt.byteimg.com/origin/pgc-image/e0ca9d6635d94516a2688b4742b23134?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("虽然切面aop可以拿到方法参数，但拿不到response，request对象。")]),t._v(" "),r("h1",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),r("p",[t._v("我们这里来总结一下过滤器、拦截器、Aspect，看看区别")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p1-tt.byteimg.com/origin/pgc-image/e8f97e5a29a54882a3189bc5a21e8015?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("如果三者方式同时采用，那他们的"),r("strong",[t._v("执行顺序是什么")]),t._v("呢？")]),t._v(" "),r("blockquote",[r("p",[t._v("filter -> interceptor -> ControllerAdvice -> aspect -> controller")])]),t._v(" "),r("p",[r("strong",[t._v("返回值顺序，或异常返回顺序")])]),t._v(" "),r("blockquote",[r("p",[t._v("controller -> aspect -> controllerAdvice -> Interceptor -> Filter")])]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p3-tt.byteimg.com/origin/pgc-image/495aae2f77af41e5b90df4545bbcf011?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})]),t._v(" "),r("p",[t._v("用一个图描述一下执行顺序")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://p6-tt.byteimg.com/origin/pgc-image/8701b36673e94fc887f403f35783f06d?from=pc",alt:"阿里二面：filter、interceptor、aspect应如何选择？很多人中招"}})])])}),[],!1,null,null,null);e.default=a.exports}}]);