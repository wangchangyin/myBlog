(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{516:function(s,t,e){"use strict";e.r(t);var n=e(8),a=Object(n.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"sa-token-sso-单点登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sa-token-sso-单点登录"}},[s._v("#")]),s._v(" Sa-Token-SSO 单点登录")]),s._v(" "),e("p",[s._v("凡是稍微上点规模的系统，统一认证中心都是绕不过去的槛。而单点登录——便是我们搭建统一认证中心的关键。")]),s._v(" "),e("h2",{attrs:{id:"_1-什么是单点登录-解决什么问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是单点登录-解决什么问题"}},[s._v("#")]),s._v(" 1.什么是单点登录？解决什么问题")]),s._v(" "),e("p",[s._v("举个场景，假设我们的系统被切割为N个部分：商城、论坛、直播、社交…… 如果用户每访问一个模块都要登录一次，那么用户将会疯掉， 为了优化用户体验，我们急需一套机制将这N个系统的认证授权互通共享，让用户在一个系统登录之后，便可以畅通无阻的访问其它所有系统。")]),s._v(" "),e("p",[s._v("单点登录——就是为了解决这个问题而生！")]),s._v(" "),e("p",[s._v("简而言之，单点登录可以做到："),e("strong",[e("code",[s._v("在多个互相信任的系统中，用户只需登录一次，就可以访问所有系统。")])])]),s._v(" "),e("h2",{attrs:{id:"_2-架构选型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-架构选型"}},[s._v("#")]),s._v(" 2.架构选型")]),s._v(" "),e("p",[s._v("对于单点登录，网上教程大多以CAS模式为主，其实对于不同的系统架构，实现单点登录的步骤也大为不同，Sa-Token 由简入难将其划分为三种模式：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("系统架构")]),s._v(" "),e("th",[s._v("采用模式")]),s._v(" "),e("th",[s._v("简介")]),s._v(" "),e("th",[s._v("文档链接")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("前端同域 + 后端同 Redis")]),s._v(" "),e("td",[s._v("模式一")]),s._v(" "),e("td",[s._v("共享 Cookie 同步会话")]),s._v(" "),e("td",[e("a",{attrs:{href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-type1",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),e("OutboundLink")],1),s._v("、"),e("a",{attrs:{href:"https://gitee.com/dromara/sa-token/blob/master/sa-token-demo/sa-token-demo-sso1-client",target:"_blank",rel:"noopener noreferrer"}},[s._v("示例"),e("OutboundLink")],1)])]),s._v(" "),e("tr",[e("td",[s._v("前端不同域 + 后端同 Redis")]),s._v(" "),e("td",[s._v("模式二")]),s._v(" "),e("td",[s._v("URL重定向传播会话")]),s._v(" "),e("td",[e("a",{attrs:{href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-type2",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),e("OutboundLink")],1),s._v("、"),e("a",{attrs:{href:"https://gitee.com/dromara/sa-token/blob/master/sa-token-demo/sa-token-demo-sso2-client",target:"_blank",rel:"noopener noreferrer"}},[s._v("示例"),e("OutboundLink")],1)])]),s._v(" "),e("tr",[e("td",[s._v("前端不同域 + 后端不同 Redis")]),s._v(" "),e("td",[s._v("模式三")]),s._v(" "),e("td",[s._v("Http请求获取会话")]),s._v(" "),e("td",[e("a",{attrs:{href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-type3",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),e("OutboundLink")],1),s._v("、"),e("a",{attrs:{href:"https://gitee.com/dromara/sa-token/blob/master/sa-token-demo/sa-token-demo-sso3-client",target:"_blank",rel:"noopener noreferrer"}},[s._v("示例"),e("OutboundLink")],1)])])])]),s._v(" "),e("ol",[e("li",[s._v("前端同域：就是指多个系统可以部署在同一个主域名之下，比如："),e("code",[s._v("c1.domain.com")]),s._v("、"),e("code",[s._v("c2.domain.com")]),s._v("、"),e("code",[s._v("c3.domain.com")]),s._v("。")]),s._v(" "),e("li",[s._v("后端同Redis：就是指多个系统可以连接同一个Redis，其它的缓存数据中心亦可。PS：这里并不需要把所有项目的数据都放在同一个Redis中，Sa-Token提供了 "),e("strong",[e("code",[s._v("[权限缓存与业务缓存分离]")])]),s._v(" 的解决方案，详情戳："),e("a",{attrs:{href:"http://sa-token.dev33.cn/doc/index.html#/plugin/alone-redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("Alone独立Redis插件"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("li",[s._v("如果既无法做到前端同域，也无法做到后端同Redis，那么只能走模式三，Http请求获取会话（Sa-Token对SSO提供了完整的封装，你只需要按照示例从文档上复制几段代码便可以轻松集成）。")]),s._v(" "),e("li",[s._v("技术选型一定要根据系统架构对症下药，切不可胡乱选择。")])]),s._v(" "),e("h2",{attrs:{id:"_3-单点登录准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-单点登录准备"}},[s._v("#")]),s._v(" 3.单点登录准备")]),s._v(" "),e("p",[s._v("在开始SSO三种模式的对接之前，我们必须先搭建一个 SSO-Server 认证中心(用于所有的系统登录的统一入口)")]),s._v(" "),e("h3",{attrs:{id:"_1-创建-springboot-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-springboot-项目"}},[s._v("#")]),s._v(" 1.创建 SpringBoot 项目")]),s._v(" "),e("p",[e("code",[s._v("sa-token-demo-sso-server")]),s._v("，引入依赖：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\x3c!-- Sa-Token 权限认证, 在线文档：http://sa-token.dev33.cn/ --\x3e\n<dependency>\n    <groupId>cn.dev33</groupId>\n    <artifactId>sa-token-spring-boot-starter</artifactId>\n    <version>1.28.0</version>\n</dependency>\n\n\x3c!-- Sa-Token 整合 Redis (使用 jackson 序列化方式) --\x3e\n<dependency>\n    <groupId>cn.dev33</groupId>\n    <artifactId>sa-token-dao-redis-jackson</artifactId>\n    <version>1.28.0</version>\n</dependency>\n<dependency>\n    <groupId>org.apache.commons</groupId>\n    <artifactId>commons-pool2</artifactId>\n</dependency>\n\n\x3c!-- 视图引擎（在前后端不分离模式下提供视图支持） --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-thymeleaf</artifactId>\n</dependency>\n\n\x3c!-- Http请求工具（在模式三的单点注销功能下用到，如不需要可以注释掉） --\x3e\n<dependency>\n     <groupId>com.ejlchina</groupId>\n     <artifactId>okhttps</artifactId>\n     <version>3.1.1</version>\n</dependency>\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("p",[s._v("除了 "),e("strong",[s._v("sa-token-spring-boot-starter")]),s._v(" 以外，其它包都是可选的：")]),s._v(" "),e("ul",[e("li",[s._v("在SSO模式三时 Redis 相关包是可选的")]),s._v(" "),e("li",[s._v("在前后端分离模式下可以删除 thymeleaf 相关包")]),s._v(" "),e("li",[s._v("在不需要SSO模式三单点注销的情况下可以删除 http 工具包")])]),s._v(" "),e("p",[s._v("建议先完整测试三种模式之后再对pom依赖进行酌情删减。")]),s._v(" "),e("h3",{attrs:{id:"_2-开放认证接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-开放认证接口"}},[s._v("#")]),s._v(" 2.开放认证接口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('/**\n * Sa-Token-SSO Server端 Controller \n */\n@RestController\npublic class SsoServerController {\n\n    /*\n     * SSO-Server端：处理所有SSO相关请求 (下面的章节我们会详细列出开放的接口) \n     */\n    @RequestMapping("/sso/*")\n    public Object ssoRequest() {\n        return SaSsoHandle.serverRequest();\n    }\n\n    /**\n     * 配置SSO相关参数 \n     */\n    @Autowired\n    private void configSso(SaTokenConfig cfg) {\n        // 配置：未登录时返回的View \n        cfg.sso.setNotLoginView(() -> {\n            String msg = "当前会话在SSO-Server端尚未登录，请先访问"\n                    + "<a href=\'/sso/doLogin?name=sa&pwd=123456\' target=\'_blank\'> doLogin登录 </a>"\n                    + "进行登录之后，刷新页面开始授权";\n            return msg;\n        });\n\n        // 配置：登录处理函数 \n        cfg.sso.setDoLoginHandle((name, pwd) -> {\n            // 此处仅做模拟登录，真实环境应该查询数据进行登录 \n            if("sa".equals(name) && "123456".equals(pwd)) {\n                StpUtil.login(10001);\n                return SaResult.ok("登录成功！").setData(StpUtil.getTokenValue());\n            }\n            return SaResult.error("登录失败！");\n        });\n\n        // 配置 Http 请求处理器 （在模式三的单点注销功能下用到，如不需要可以注释掉） \n        cfg.sso.setSendHttp(url -> {\n            return OkHttps.sync(url).get().getBody().toString();\n        });\n    }\n\n}\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br")])]),e("p",[s._v("注：在"),e("code",[s._v("setDoLoginHandle")]),s._v("函数里如果要获取name, pwd以外的参数，可通过"),e("code",[s._v('SaHolder.getRequest().getParam("xxx")')]),s._v("来获取")]),s._v(" "),e("p",[s._v("全局异常处理：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@RestControllerAdvice\npublic class GlobalExceptionHandler {\n    // 全局异常拦截 \n    @ExceptionHandler\n    public SaResult handlerException(Exception e) {\n        e.printStackTrace(); \n        return SaResult.error(e.getMessage());\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"_3-yml配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-yml配置"}},[s._v("#")]),s._v(" 3.yml配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 端口\nserver:\n    port: 9000\n\n# Sa-Token 配置\nsa-token: \n    # -------------- SSO-模式一相关配置  (非模式一不需要配置) \n    # cookie: \n        # 配置Cookie作用域 \n        # domain: stp.com \n\n    # ------- SSO-模式二相关配置 \n    sso: \n        # Ticket有效期 (单位: 秒)，默认五分钟 \n        ticket-timeout: 300\n        # 所有允许的授权回调地址\n        allow-url: "*"\n        # 是否打开单点注销功能\n        is-slo: true\n\n        # ------- SSO-模式三相关配置 （下面的配置在SSO模式三并且 is-slo=true 时打开） -------\n        # 是否打开模式三 \n        isHttp: true\n        # 接口调用秘钥（用于SSO模式三的单点注销功能）\n        secretkey: kQwIOrYvnXmSDkwEiFngrKidMcdrgKor\n        # ---- 除了以上配置项，你还需要为 Sa-Token 配置http请求处理器（文档有步骤说明） \n\nspring: \n    # Redis配置 （SSO模式一和模式二使用Redis来同步会话）\n    redis:\n        # Redis数据库索引（默认为0）\n        database: 1\n        # Redis服务器地址\n        host: 127.0.0.1\n        # Redis服务器连接端口\n        port: 6379\n        # Redis服务器连接密码（默认为空）\n        password: \n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br")])]),e("p",[s._v("注意点："),e("code",[s._v("allow-url")]),s._v("为了方便测试配置为"),e("code",[s._v("*")]),s._v("，线上生产环境一定要配置为详细URL地址 （之后的章节我们会详细阐述此配置项）")]),s._v(" "),e("h3",{attrs:{id:"_4-启动类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-启动类"}},[s._v("#")]),s._v(" 4.启动类")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@SpringBootApplication\npublic class SaSsoServerApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(SaSsoServerApplication.class, args);\n        System.out.println("\\n------ Sa-Token-SSO 认证中心启动成功");\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("5.访问统一授权地址：")]),s._v(" "),e("ul",[e("li",[s._v("http://localhost:9000/sso/auth")])]),s._v(" "),e("p",[s._v("可以看到这个页面目前非常简陋，这是因为我们以上的代码示例，主要目标是为了带大家从零搭建一个可用的SSO认证服务端，所以就对一些不太必要的步骤做了简化。")]),s._v(" "),e("p",[s._v("大家可以下载运行一下官方仓库里的示例"),e("code",[s._v("/sa-token-demo/sa-token-demo-sso-server/")]),s._v("，里面有制作好的登录页面：")]),s._v(" "),e("p",[s._v("默认账号密码为："),e("code",[s._v("sa / 123456")]),s._v("，先别着急点击登录，因为我们还没有搭建对应的 Client 端项目， 真实项目中我们是不会直接从浏览器访问 "),e("code",[s._v("/sso/auth")]),s._v(" 授权地址的，我们需要在 Client 端点击登录按钮重定向而来。")]),s._v(" "),e("p",[s._v("现在我们先来看看除了 "),e("code",[s._v("/sso/auth")]),s._v(" 统一授权地址，这个 SSO-Server 认证中心还开放了哪些API。")]),s._v(" "),e("h2",{attrs:{id:"_4-单点登录api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-单点登录api"}},[s._v("#")]),s._v(" 4.单点登录API")]),s._v(" "),e("p",[s._v("如果你仅仅使用 Sa-Token 搭建 SSO-Server 端，而 Client 端使用其它框架的话，那么下面的 API 列表将给你的对接步骤做一份参考。")]),s._v(" "),e("p",[s._v("如果你在 Client 端也用到了 Sa-Token 框架，那么你可以选择跳过本小节，Sa-Token 对 Client 端也提供了相应的封装，你可以直接开始学习："),e("a",{attrs:{href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-type1",target:"_blank",rel:"noopener noreferrer"}},[s._v("SSO模式一 共享Cookie同步会话"),e("OutboundLink")],1)]),s._v(" "),e("blockquote",[e("p",[s._v("在未登录情况下，单点登录提供了四个接口")])]),s._v(" "),e("h3",{attrs:{id:"_1-单点登录授权地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-单点登录授权地址"}},[s._v("#")]),s._v(" 1.单点登录授权地址")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://{host}:{port}/sso/auth\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("接收参数：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("参数")]),s._v(" "),e("th",[s._v("是否必填")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("redirect")]),s._v(" "),e("td",[s._v("是")]),s._v(" "),e("td",[s._v("登录成功后的重定向地址，一般填写 location.href（从哪来回哪去）")])]),s._v(" "),e("tr",[e("td",[s._v("mode")]),s._v(" "),e("td",[s._v("否")]),s._v(" "),e("td",[s._v("授权模式，取值 [simple, ticket]，simple=登录后直接重定向，ticket=带着ticket参数重定向，默认值为ticket")])])])]),s._v(" "),e("p",[s._v("访问接口后有两种情况：")]),s._v(" "),e("ul",[e("li",[s._v("情况一：当前会话在 SSO 认证中心未登录，会进入登录页开始登录。")]),s._v(" "),e("li",[s._v("情况二：当前会话在 SSO 认证中心已登录，会被重定向至 "),e("code",[s._v("redirect")]),s._v(" 地址，并携带 "),e("code",[s._v("ticket")]),s._v(" 参数。")])]),s._v(" "),e("h3",{attrs:{id:"_2-restapi-登录接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-restapi-登录接口"}},[s._v("#")]),s._v(" 2.RestAPI 登录接口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://{host}:{port}/sso/doLogin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("接收参数：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("参数")]),s._v(" "),e("th",[s._v("是否必填")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("name")]),s._v(" "),e("td",[s._v("是")]),s._v(" "),e("td",[s._v("用户名")])]),s._v(" "),e("tr",[e("td",[s._v("pwd")]),s._v(" "),e("td",[s._v("是")]),s._v(" "),e("td",[s._v("密码")])])])]),s._v(" "),e("p",[s._v("此接口属于 RestAPI (使用ajax访问)，会进入后端配置的 "),e("code",[s._v("setDoLoginHandle")]),s._v(" 函数中，另外需要注意： 此接口并非只能携带 name、pwd 参数，因为你可以在 setDoLoginHandle 函数里通过 "),e("code",[s._v('SaHolder.getRequest().getParam("xxx")')]),s._v(" 来获取其它参数。")]),s._v(" "),e("h3",{attrs:{id:"_3-ticket-校验接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-ticket-校验接口"}},[s._v("#")]),s._v(" 3.Ticket 校验接口")]),s._v(" "),e("p",[s._v("此接口仅配置模式三 "),e("code",[s._v("(isHttp=true)")]),s._v(" 时打开")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://{host}:{port}/sso/checkTicket\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("接收参数：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("参数")]),s._v(" "),e("th",[s._v("是否必填")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("ticket")]),s._v(" "),e("td",[s._v("是")]),s._v(" "),e("td",[s._v("在步骤 5.1 中授权重定向时的 ticket 参数")])]),s._v(" "),e("tr",[e("td",[s._v("ssoLogoutCall")]),s._v(" "),e("td",[s._v("否")]),s._v(" "),e("td",[s._v("单点注销时的回调通知地址，只在SSO模式三单点注销时需要携带此参数")])])])]),s._v(" "),e("p",[s._v("返回值场景：")]),s._v(" "),e("ul",[e("li",[s._v("返回空，代表校验失败。")]),s._v(" "),e("li",[s._v("返回具体的 loginId，例如10001，代表校验成功，值为此 ticket 码代表的用户id。")])]),s._v(" "),e("h3",{attrs:{id:"_4-单点注销接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-单点注销接口"}},[s._v("#")]),s._v(" 4.单点注销接口")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://{host}:{port}/sso/logout         \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("接受参数：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("参数")]),s._v(" "),e("th",[s._v("是否必填")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("loginId")]),s._v(" "),e("td",[s._v("否")]),s._v(" "),e("td",[s._v("要注销的账号id")])]),s._v(" "),e("tr",[e("td",[s._v("secretkey")]),s._v(" "),e("td",[s._v("否")]),s._v(" "),e("td",[s._v("接口通信秘钥")])]),s._v(" "),e("tr",[e("td",[s._v("back")]),s._v(" "),e("td",[s._v("否")]),s._v(" "),e("td",[s._v("注销成功后的重定向地址")])])])]),s._v(" "),e("p",[s._v("此接口有两种调用方式")]),s._v(" "),e("h5",{attrs:{id:"方式一-在-client-的前端页面引导用户直接跳转-并带有-back-参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方式一-在-client-的前端页面引导用户直接跳转-并带有-back-参数"}},[s._v("#")]),s._v(" "),e("a",{attrs:{href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-server?id=%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E5%9C%A8-client-%E7%9A%84%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%BC%95%E5%AF%BC%E7%94%A8%E6%88%B7%E7%9B%B4%E6%8E%A5%E8%B7%B3%E8%BD%AC%EF%BC%8C%E5%B9%B6%E5%B8%A6%E6%9C%89-back-%E5%8F%82%E6%95%B0",target:"_blank",rel:"noopener noreferrer"}},[s._v("方式一：在 Client 的前端页面引导用户直接跳转，并带有 back 参数"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("例如："),e("code",[s._v("http://{host}:{port}/sso/logout?back=xxx")]),s._v("，代表用户注销成功后返回back地址")]),s._v(" "),e("h5",{attrs:{id:"方式二-在-client-的后端通过-http-工具来调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方式二-在-client-的后端通过-http-工具来调用"}},[s._v("#")]),s._v(" "),e("a",{attrs:{href:"https://sa-token.dev33.cn/doc/index.html#/sso/sso-server?id=%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E5%9C%A8-client-%E7%9A%84%E5%90%8E%E7%AB%AF%E9%80%9A%E8%BF%87-http-%E5%B7%A5%E5%85%B7%E6%9D%A5%E8%B0%83%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("方式二：在 Client 的后端通过 http 工具来调用"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("例如："),e("code",[s._v("http://{host}:{port}/sso/logout?loginId={value}&secretkey={value}")]),s._v("，代表注销 账号=loginId 的账号，返回json数据结果，形如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n    "code": 200,    // 200表示请求成功，非200标识请求失败\n    "msg": "单点注销成功",\n    "data": null\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])])}),[],!1,null,null,null);t.default=a.exports}}]);