(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{486:function(s,a,e){"use strict";e.r(a);var n=e(8),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"sleuth链路追踪"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sleuth链路追踪"}},[s._v("#")]),s._v(" Sleuth链路追踪")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/spring-cloud/spring-cloud-sleuth",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网："),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"_1-为什么会出现这个技术"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么会出现这个技术"}},[s._v("#")]),s._v(" 1.为什么会出现这个技术？")]),s._v(" "),e("p",[s._v("在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节点调用来协同产生最后的请求结果，每一个前段请求都会形成一条复杂的分布式服务调用链路，链路中的任何一环出现高延时或错误都会引起整个请求最后的失败。")]),s._v(" "),e("p",[s._v("比如：订单=》支付、库存、积分、物流等等")]),s._v(" "),e("h2",{attrs:{id:"_2-sleuth是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-sleuth是什么"}},[s._v("#")]),s._v(" 2.Sleuth是什么")]),s._v(" "),e("p",[s._v("Spring Cloud Sleuth提供了一套完整的服务跟踪的解决方案")]),s._v(" "),e("p",[s._v("在分布式系统中提供追踪解决方案并且兼容支持了zipkin（可视化界面）")]),s._v(" "),e("h2",{attrs:{id:"_3-下载zipkin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-下载zipkin"}},[s._v("#")]),s._v(" 3.下载zipkin")]),s._v(" "),e("p",[s._v("SpringCloud从F版起已不需要自己构建Zipkin Server了，只需调用jar包即可")]),s._v(" "),e("p",[s._v("方式一：")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/",target:"_blank",rel:"noopener noreferrer"}},[s._v("手动下载地址"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("方式二：cmd命令下载")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("curl -sSL https://zipkin.io/quickstart.sh | bash -s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("运行：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("java -jar zipkin.jar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_4-springcloud整合sleuth"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-springcloud整合sleuth"}},[s._v("#")]),s._v(" 4.Springcloud整合Sleuth")]),s._v(" "),e("p",[s._v("修改8001、80")]),s._v(" "),e("h3",{attrs:{id:"_1-导入依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-导入依赖"}},[s._v("#")]),s._v(" 1.导入依赖")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("        \x3c!--包含了sleuth+zipkin--\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-zipkin</artifactId>\n        </dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改配置"}},[s._v("#")]),s._v(" 2.修改配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server:\n  port: 8001\n\nspring:\n  application:\n    name: cloud-payment-service\n  #整合sleuth数据链路\n  zipkin:\n    base-url: http://localhost:9411\n  sleuth:\n    sampler:\n      #采样率值介于 0 到 1 之间，1 则表示全部采集\n      probability: 1\n  datasource:\n    type: com.alibaba.druid.pool.DruidDataSource            # 当前数据源操作类型\n    driver-class-name: org.gjt.mm.mysql.Driver              # mysql驱动包\n    url: jdbc:mysql://121.40.132.169:3306/cloud2021?useUnicode=true&characterEncoding=utf-8&useSSL=false\n    username: root\n    password: wW2452952178\n\neureka:\n  client:\n    #表示是否将自己注册进EurekaServer默认为true。\n    register-with-eureka: true\n    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡\n    fetchRegistry: true\n    service-url:\n      #defaultZone: http://localhost:7001/eureka  #单机版\n      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka  # 集群版\n  instance:\n    instance-id: payment8001  #不显示主机名，显示别名payment8001\n    prefer-ip-address: true     #访问路径可以显示IP地址\n    #########################心跳检测与续约时间############################################\n    #Eureka客户端向服务端发送心跳的时间间隔，单位为秒(默认是30秒)\n#    lease-renewal-interval-in-seconds: 1\n#    #Eureka服务端在收到最后一次心跳后等待时间上限，单位为秒(默认是90秒)，超时将剔除服务\n#    lease-expiration-duration-in-seconds: 2\n\nmybatis:\n  mapperLocations: classpath:mapper/*.xml\n  type-aliases-package: com.wcy.springcloud.entities    # 所有Entity别名类所在包\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br")])]),e("h3",{attrs:{id:"_3-测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试"}},[s._v("#")]),s._v(" 3.测试")]),s._v(" "),e("ul",[e("li",[s._v("启动eureka7001/7002")]),s._v(" "),e("li",[s._v("启动cloud-provider-payment8001、cloud-consumer-order80")])]),s._v(" "),e("p",[s._v("访问地址：http://localhost/consumer/payment/port")])])}),[],!1,null,null,null);a.default=t.exports}}]);