(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{476:function(e,s,a){"use strict";a.r(s);var n=a(8),r=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"eureka基础篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eureka基础篇"}},[e._v("#")]),e._v(" Eureka基础篇")]),e._v(" "),a("h2",{attrs:{id:"_1-eureka基础知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-eureka基础知识"}},[e._v("#")]),e._v(" 1.Eureka基础知识")]),e._v(" "),a("p",[e._v("类似于尚硅谷教学，需要给物业管理人员交物业费，交了物业费以后，同学们（消费者）就可以在物业管理中知道尚硅谷办理了教学服务；若在几个周期都没有交物业费，那么物业管理人员就默认认为尚硅谷不办教学了，同学们就看不到尚硅谷教学了。")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("什么是服务治理：")]),e._v(" "),a("blockquote",[a("p",[e._v("在传统的rpc远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理比较复杂，所以需要使用服务治理，管理服务于服务之间依赖关系，可以实现服务调用、负载均衡、容错等，实现服务发现与注册。")])])]),e._v(" "),a("li",[a("p",[e._v("服务注册与发现：")]),e._v(" "),a("blockquote",[a("p",[e._v("Eureka采用了"),a("strong",[e._v("CS")]),e._v("的设计架构，"),a("strong",[e._v("Eureka Server 作为服务注册功能的服务器")]),e._v("，它是服务注册中心。而系统中的其他微服务，使用 Eureka的客户端连接到 Eureka Server并维持"),a("strong",[e._v("心跳连接")]),e._v("。这样系统的维护人员就可以通过 Eureka Server 来监控系统中各个微服务是否正常运行。\n在服务注册与发现中，有一个"),a("strong",[e._v("注册中心")]),e._v("。当"),a("strong",[e._v("服务器")]),e._v("启动的时候，**会把当前自己服务器的信息 比如 服务地址通讯地址等以别名方式注册到注册中心上。**另一方（"),a("strong",[e._v("消费者")]),e._v("|服务提供者），"),a("strong",[e._v("以该别名的方式去注册中心上获取到实际的服务通讯地址")]),e._v("，然后再实现本地RPC调用RPC远程调用框架核心设计思想：在于注册中心，因为使用注册中心管理每个服务与服务之间的一个依赖关系(服务治理概念)。在任何rpc远程框架中，都会有一个注册中心(存放服务地址相关信息(接口地址))")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/2021-05-17_103555.png",alt:"2021-05-17_103555"}})])]),e._v(" "),a("li",[a("p",[e._v("Eureka两大组件")]),e._v(" "),a("blockquote",[a("p",[e._v("1.Eureka Server提供服务注册服务\n各个微服务节点通过配置启动后，会在EurekaServer中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观看到。")]),e._v(" "),a("p",[e._v("2.EurekaClient通过注册中心进行访问\n是一个Java客户端，用于简化Eureka Server的交互，客户端同时也具备一个内置的、使用轮询(round-robin)负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳(默认周期为30秒)。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，EurekaServer将会从服务注册表中把这个服务节点移除（默认90秒）")])])])]),e._v(" "),a("h2",{attrs:{id:"_2-eureka单机版使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-eureka单机版使用"}},[e._v("#")]),e._v(" 2.Eureka单机版使用")]),e._v(" "),a("h3",{attrs:{id:"_1-注册eureka服务中心-单机版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-注册eureka服务中心-单机版"}},[e._v("#")]),e._v(" 1.注册Eureka服务中心（单机版）")]),e._v(" "),a("p",[a("strong",[e._v("核心部分依然是这五部：")])]),e._v(" "),a("ol",[a("li",[e._v("加moudle")]),e._v(" "),a("li",[e._v("改pom")]),e._v(" "),a("li",[e._v("加yml")]),e._v(" "),a("li",[e._v("加主启动类（记得开启Eureka服务）")]),e._v(" "),a("li",[e._v("添加业务类")])]),e._v(" "),a("p",[a("strong",[e._v("详细步骤：")])]),e._v(" "),a("p",[e._v("1.新建moudle：cloud-eureka-server7001")]),e._v(" "),a("p",[e._v("2.改pom文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>CloudStudy</artifactId>\n        <groupId>com.wcy.springcloud</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>cloud-eureka-server7001</artifactId>\n\n    <dependencies>\n        \x3c!--eureka-server--\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\n        </dependency>\n        \x3c!-- 引入自己定义的api通用包，可以使用Payment支付Entity --\x3e\n        <dependency>\n            <groupId>com.wcy.springcloud</groupId>\n            <artifactId>cloud-api-commons</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \x3c!--boot web actuator--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n        \x3c!--一般通用配置--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <scope>runtime</scope>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n        </dependency>\n    </dependencies>\n</project>\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br"),a("span",{staticClass:"line-number"},[e._v("41")]),a("br"),a("span",{staticClass:"line-number"},[e._v("42")]),a("br"),a("span",{staticClass:"line-number"},[e._v("43")]),a("br"),a("span",{staticClass:"line-number"},[e._v("44")]),a("br"),a("span",{staticClass:"line-number"},[e._v("45")]),a("br"),a("span",{staticClass:"line-number"},[e._v("46")]),a("br"),a("span",{staticClass:"line-number"},[e._v("47")]),a("br"),a("span",{staticClass:"line-number"},[e._v("48")]),a("br"),a("span",{staticClass:"line-number"},[e._v("49")]),a("br"),a("span",{staticClass:"line-number"},[e._v("50")]),a("br"),a("span",{staticClass:"line-number"},[e._v("51")]),a("br"),a("span",{staticClass:"line-number"},[e._v("52")]),a("br"),a("span",{staticClass:"line-number"},[e._v("53")]),a("br"),a("span",{staticClass:"line-number"},[e._v("54")]),a("br"),a("span",{staticClass:"line-number"},[e._v("55")]),a("br"),a("span",{staticClass:"line-number"},[e._v("56")]),a("br")])]),a("p",[e._v("3.添加yml文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("server:\n  port: 7001\n\neureka:\n  instance:\n    hostname: localhost #eureka服务端的实例名称\n  client:\n    #false表示不向注册中心注册自己。\n    register-with-eureka: false\n    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务\n    fetch-registry: false\n    service-url:\n      #设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。\n      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])]),a("p",[e._v("4.添加启动类，并开启Eureka服务")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("package com.wcy.springcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;\n\n@SpringBootApplication\n//开启Eureka服务端服务\n@EnableEurekaServer\npublic class EurekaMain7001 {\n    public static void main(String[] args) {\n        SpringApplication.run(EurekaMain7001.class,args);\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])]),a("h3",{attrs:{id:"_2-把客户端-消费者、生产者-注册到eureka中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-把客户端-消费者、生产者-注册到eureka中"}},[e._v("#")]),e._v(" 2.把客户端（消费者、生产者）注册到Eureka中")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("添加pom依赖")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\x3c!--eureka-client--\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n        </dependency>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("添加yml")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#spring.application.name必须要，后续Eureka注册名就是这个\nspring:\n  application:\n    name: cloud-XXXX-service\n\neureka:\n  client:\n    #表示是否将自己注册进EurekaServer默认为true。\n    register-with-eureka: true\n    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡\n    fetchRegistry: true\n    service-url:\n      defaultZone: http://localhost:7001/eureka\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("开启Eureka客户端")]),e._v(" "),a("p",[e._v("在启动类上加上注解@EnableEurekaClient")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("package com.wcy.springcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\n\n@SpringBootApplication\n@EnableEurekaClient\npublic class PaymentMain8001 {\n    public static void main(String[] args) {\n        SpringApplication.run(PaymentMain8001.class, args);\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])])])]),e._v(" "),a("h2",{attrs:{id:"_2-eureka集群配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-eureka集群配置"}},[e._v("#")]),e._v(" 2.Eureka集群配置")]),e._v(" "),a("h3",{attrs:{id:"_1-注册两个eureka服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-注册两个eureka服务"}},[e._v("#")]),e._v(" 1.注册两个eureka服务")]),e._v(" "),a("p",[e._v("与单机不同点：")]),e._v(" "),a("ol",[a("li",[e._v("需要修改本地映射文件")]),e._v(" "),a("li",[e._v("修改yml文件")])]),e._v(" "),a("p",[a("strong",[e._v("集群采用相互注册的方式，即若1、2、3，三个服务，那么1服务会注册2、3的服务，2服务会注册1、3的服务，3服务会注册1、2的服务")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("注册两个eureka服务：cloud-eureka-server7001、cloud-eureka-server7002")])]),e._v(" "),a("li",[a("p",[e._v("修改yml文件")]),e._v(" "),a("p",[e._v("在修改yml之前，需要修改本地的hosts文件地址映射")]),e._v(" "),a("blockquote",[a("p",[e._v("1.找到C:\\Windows\\System32\\drivers\\etc下面的hosts文件；")]),e._v(" "),a("p",[e._v("​\t可能会出现权限无法编辑，给了权限还是无法修改，那么可以使用EditPlus文本编辑器来修改")]),e._v(" "),a("p",[e._v("2.添加内容：")]),e._v(" "),a("p",[e._v("127.0.0.1 eureka7001.com")]),e._v(" "),a("p",[e._v("127.0.0.1 eureka7002.com")])]),e._v(" "),a("p",[e._v("7001的配置文件内容：7001要注册到7002的服务中")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("server:\n  port: 7001\n\neureka:\n  instance:\n    hostname: eureka7001.com #eureka服务端的实例名称\n  client:\n    #false表示不向注册中心注册自己。\n    register-with-eureka: false\n    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务\n    fetch-registry: false\n    service-url:\n      #设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。\n      defaultZone: http://eureka7002.com:7002/eureka/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])]),a("p",[e._v("7002的配置文件内容：7002要注册到7001的服务中")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("server:\n  port: 7002\n\neureka:\n  instance:\n    hostname: eureka7002.com #eureka服务端的实例名称\n  client:\n    #false表示不向注册中心注册自己。\n    register-with-eureka: false\n    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务\n    fetch-registry: false\n    service-url:\n      #设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。\n      defaultZone: http://eureka7001.com:7001/eureka/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br")])])])]),e._v(" "),a("p",[e._v("3.启动两个eureka服务，访问方式：127.0.0.1:7001或eureka7001.com:7001（上面配置的地址映射）来访问")]),e._v(" "),a("h3",{attrs:{id:"_2-把客户端-消费者、生产者-注册到eureka集群中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-把客户端-消费者、生产者-注册到eureka集群中"}},[e._v("#")]),e._v(" 2.把客户端（消费者、生产者）注册到Eureka集群中")]),e._v(" "),a("p",[e._v("只需要修改yml文件即可，其他和单机版一样")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("eureka:\n  client:\n    #表示是否将自己注册进EurekaServer默认为true。\n    register-with-eureka: true\n    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡\n    fetchRegistry: true\n    service-url:\n      #defaultZone: http://localhost:7001/eureka  #单机版\n      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka  # 集群版\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("h2",{attrs:{id:"_3-搭建订单-生产者-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-搭建订单-生产者-集群"}},[e._v("#")]),e._v(" 3.搭建订单（生产者）集群")]),e._v(" "),a("p",[e._v("上面部分已经完成了eureka集群，还需要搭建生产者集群。")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/2021-05-17_164622.png",alt:"2021-05-17_164622"}})]),e._v(" "),a("p",[a("strong",[e._v("搭建方式：")])]),e._v(" "),a("p",[e._v("1.新建模块cloud-provider-payment8002，复制之前的cloud-provider-payment8001，只需要修改端口即可")]),e._v(" "),a("p",[e._v("2.修改controller层，输出端口号，方便知道消费者访问的哪个端口")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('    @Value("${server.port}")\n    private String serverPort;//端口号\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("3.修改"),a("strong",[e._v("消费者")]),e._v("访问的地址，之前是写死的，访问的8001端口，现在后端有两个服务了")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('public class OrderController {\n    //private static final String PAMENT_URL="http://localhost:8001";\n    private static final String PAMENT_URL="http://CLOUD-PAYMENT-SERVICE";//访问服务器名\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("4.这样之后没法访问了，因为访问http://CLOUD-PAYMENT-SERVICE地址，服务器不知道访问8001和8002哪个端口，在之前注入RestTemplate的时候增加注解@LoadBalanced，实现负载均衡，")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@Configuration\npublic class ApplicationContextConfig\n{\n    @Bean\n    @LoadBalanced\n    public RestTemplate getRestTemplate()\n    {\n        return new RestTemplate();\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("h2",{attrs:{id:"_4-actuator微服务信息提示完善"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-actuator微服务信息提示完善"}},[e._v("#")]),e._v(" 4.actuator微服务信息提示完善")]),e._v(" "),a("p",[e._v("比如Euraka图形界面不要出现主机名，点击超链接显示具体的地址")]),e._v(" "),a("h3",{attrs:{id:"问题一-不要出现euraka图形界面主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题一-不要出现euraka图形界面主机名"}},[e._v("#")]),e._v(" 问题一：不要出现Euraka图形界面主机名")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/2021-05-17_171508.png",alt:"2021-05-17_171508"}})]),e._v(" "),a("h3",{attrs:{id:"问题二-点击超链接显示具体的ip地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题二-点击超链接显示具体的ip地址"}},[e._v("#")]),e._v(" 问题二：点击超链接显示具体的IP地址")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/2021-05-17_172132.png",alt:"2021-05-17_172132"}})]),e._v(" "),a("p",[e._v("修改yml配置文件：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("eureka:\n  client:\n    #表示是否将自己注册进EurekaServer默认为true。\n    register-with-eureka: true\n    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡\n    fetchRegistry: true\n    service-url:\n      #defaultZone: http://localhost:7001/eureka  #单机版\n      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka  # 集群版\n  instance:\n    instance-id: payment8001    #不显示主机名，显示别名payment8001\n    prefer-ip-address: true     #访问路径可以显示IP地址\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("h2",{attrs:{id:"_5-discovery服务发现-对方暴露ip-端口号等信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-discovery服务发现-对方暴露ip-端口号等信息"}},[e._v("#")]),e._v(" 5.discovery服务发现（对方暴露ip+端口号等信息）")]),e._v(" "),a("p",[e._v("1.消费者主启动类开启@EnableDiscoveryClient")]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("controller层加入get方法")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('    @Autowired\n    private DiscoveryClient discoveryClient;\n    \n     /**\n     * 对外暴露该服务的信息\n     * @return\n     */\n    @GetMapping("/payment/discovery")\n    public Object discovery(){\n        List<String> services = discoveryClient.getServices();//获取在eureka的注册服务\n        for (String service:services){\n            log.info("服务:"+service);\n            List<ServiceInstance> instances = discoveryClient.getInstances(service);\n            for(ServiceInstance serviceInstance:instances){\n                log.info(serviceInstance.getServiceId()+"-"+serviceInstance.getHost()\n                +"-"+serviceInstance.getPort()+"-"+serviceInstance.getUri());\n            }\n        }\n        log.info(""+discoveryClient.getOrder());\n        return services;\n    }\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br")])]),a("h2",{attrs:{id:"_6-eureka的自我保护机制-默认开启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-eureka的自我保护机制-默认开启"}},[e._v("#")]),e._v(" 6.Eureka的自我保护机制（默认开启）")]),e._v(" "),a("ol",[a("li",[e._v("Eureka自我保护机制：Eureka客户端默认每30秒发送一次心跳，若90秒内未收到心跳会被剔除；")]),e._v(" "),a("li",[e._v("属于CAP中的CA，需要高可用；")])]),e._v(" "),a("blockquote",[a("p",[e._v("保护模式主要用于一组客户端和Eureka Server之间存在网络分区场景下的保护。一旦进入保护模式，\nEureka Server将会尝试保护其服务注册表中的信息，不再删除服务注册表中的数据，也就是不会注销任何微服务。")]),e._v(" "),a("p",[e._v("如果在Eureka Server的首页看到以下这段提示，则说明Eureka进入了保护模式：\nEMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY'RE NOT.\nRENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE")])]),e._v(" "),a("p",[a("strong",[e._v("关闭自我保护机制：")])]),e._v(" "),a("p",[e._v("1.eureka服务端配置：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("eureka:\n  instance:\n    hostname: eureka7001.com #eureka服务端的实例名称\n  client:\n    #false表示不向注册中心注册自己。\n    register-with-eureka: false\n    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务\n    fetch-registry: false\n    service-url:\n      #设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。\n      defaultZone: http://eureka7002.com:7002/eureka/\n  server:\n    #########################心跳检测与续约时间############################################\n    #关闭自我保护机制，保证不可用服务被及时踢除\n    enable-self-preservation: false\n    # 2秒内未接受到心跳则关闭微服务\n    eviction-interval-timer-in-ms: 2000\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br")])]),a("p",[e._v("2.eureka客户端配置：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("eureka:\n  client:\n    #表示是否将自己注册进EurekaServer默认为true。\n    register-with-eureka: true\n    #是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡\n    fetchRegistry: true\n    service-url:\n      #defaultZone: http://localhost:7001/eureka  #单机版\n      defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka  # 集群版\n  instance:\n    instance-id: payment8001  #不显示主机名，显示别名payment8001\n    prefer-ip-address: true     #访问路径可以显示IP地址\n    #########################心跳检测与续约时间############################################\n    #Eureka客户端向服务端发送心跳的时间间隔，单位为秒(默认是30秒)\n    lease-renewal-interval-in-seconds: 1\n    #Eureka服务端在收到最后一次心跳后等待时间上限，单位为秒(默认是90秒)，超时将剔除服务\n    lease-expiration-duration-in-seconds: 2\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);