(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{477:function(e,s,a){"use strict";a.r(s);var n=a(8),r=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper"}},[e._v("#")]),e._v(" ZooKeeper")]),e._v(" "),a("h2",{attrs:{id:"_1-linux安装zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-linux安装zookeeper"}},[e._v("#")]),e._v(" 1.linux安装Zookeeper")]),e._v(" "),a("p",[e._v("参考地址：https://www.cnblogs.com/expiator/p/9853378.html")]),e._v(" "),a("p",[e._v("前提：已经安装了jdk")]),e._v(" "),a("p",[e._v("1.https://archive.apache.org/dist/zookeeper/  找到对应的版本下载")]),e._v(" "),a("p",[a("strong",[e._v("安装命令操作：")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("1.解压：\ntar -zxvf zookeeper-3.4.14.tar.gz 解压\n2.进入conf目录：\ncd zookeeper-3.4.14/conf\n3.将zoo_sample.cfg这个文件复制为zoo.cfg (必须是这个文件名)\ncp  zoo_sample.cfg  zoo.cfg\n4. 进入zoo.cfg文件进行编辑\nvi zoo.cfg\n    修改以下内容\n    dataDir=/tmp/zookeeper/data\n    dataLogDir=/tmp/zookeeper/log\n5.创建对应的文件夹\nmkdir /tmp/zookeeper\nmkdir /tmp/zookeeper/data\nmkdir /tmp/zookeeper/log\n6.配置环境变量\nexport ZOOKEEPER_INSTALL=/root/zookeeper/zookeeper-3.4.14/\nexport PATH=$PATH:$ZOOKEEPER_INSTALL/bin\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br")])]),a("h2",{attrs:{id:"_2-启动zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动zookeeper"}},[e._v("#")]),e._v(" 2.启动Zookeeper")]),e._v(" "),a("p",[e._v("1.进入bin目录，并启动zookeep。如果不是在bin目录下执行，启动zookeeper时会报错： bash: ./zkServer.sh: No such file or directory")]),e._v(" "),a("p",[e._v("注意： ./zkServer.sh start前面的 . 不可忽略。")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@localhost local]# cd /root/zookeeper/zookeeper-3.4.14/bin\n[root@localhost bin]# ./zkServer.sh start\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("2.启动成功效果")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ZooKeeper JMX enabled by default\nUsing config: /usr/local/zookeeper-3.4.13/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("3.zookeeper的服务端启动后，还需要启动zookeeper的客户端")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@localhost bin]# ./zkCli.sh\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("启动成功效果如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Connecting to localhost:2181..............................Welcome to ZooKeeper!\n2018-10-25 21:04:54,407 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181. Will not attempt to authenticate using SASL (unknown error)\nJLine support is enabled\n2018-10-25 21:04:54,471 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@879] - Socket connection established to localhost/0:0:0:0:0:0:0:1:2181, initiating session\n[zk: localhost:2181(CONNECTING) 0] 2018-10-25 21:04:54,501 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, sessionid = 0x10000712e6f0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("p",[e._v("4.查看状态：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@localhost bin]# ./zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /usr/local/zookeeper-3.4.13/bin/../conf/zoo.cfg\nMode: standalone\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"_3-集群版安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-集群版安装"}},[e._v("#")]),e._v(" 3.集群版安装")]),e._v(" "),a("blockquote",[a("p",[e._v("在同一个机子上面搭建三个zookeeper，伪集群")])]),e._v(" "),a("h3",{attrs:{id:"_1-创建文件目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建文件目录结构"}},[e._v("#")]),e._v(" 1.创建文件目录结构")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir -pv /opt/module/zookeeper/server1\nmkdir -pv /opt/module/zookeeper/server2\nmkdir -pv /opt/module/zookeeper/server3\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"_2-创建数据存放和日志文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建数据存放和日志文件"}},[e._v("#")]),e._v(" 2.创建数据存放和日志文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir -pv /opt/module/zookeeper/server1/data\nmkdir -pv /opt/module/zookeeper/server1/log\nmkdir -pv /opt/module/zookeeper/server2/data\nmkdir -pv /opt/module/zookeeper/server2/log\nmkdir -pv /opt/module/zookeeper/server3/data\nmkdir -pv /opt/module/zookeeper/server3/log\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h3",{attrs:{id:"_3-创建zookeeper集群id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建zookeeper集群id"}},[e._v("#")]),e._v(" 3.创建zookeeper集群ID")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('echo "1" > /opt/module/zookeeper/server1/data/myid\necho "2" > /opt/module/zookeeper/server2/data/myid\necho "3" > /opt/module/zookeeper/server3/data/myid\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"_4-下载zookeeper-参考单机版-下载、解压"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-下载zookeeper-参考单机版-下载、解压"}},[e._v("#")]),e._v(" 4.下载zookeeper（参考单机版 下载、解压）")]),e._v(" "),a("p",[e._v("解压到/opt/module/zookeeper/server1/目录")]),e._v(" "),a("p",[e._v("目录结构图：")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210803191546646.png",alt:"image-20210803191546646"}})]),e._v(" "),a("h3",{attrs:{id:"_4-修改配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改配置文件"}},[e._v("#")]),e._v(" 4.修改配置文件")]),e._v(" "),a("blockquote",[a("p",[e._v("注意：配置文件名字要改为zoo.cfg")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cd /opt/module/zookeeper/server1/zookeeper-3.4.14/conf\nvi zoo.cfg\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("需要修改的地方：")]),e._v(" "),a("ul",[a("li",[e._v("clientPort=2181：端口号\n"),a("ul",[a("li",[e._v("2181、2182、2183")])])]),e._v(" "),a("li",[e._v("dataDir：数据文件\n"),a("ul",[a("li",[e._v("/opt/module/zookeeper/server1/data")]),e._v(" "),a("li",[e._v("/opt/module/zookeeper/server2/data")]),e._v(" "),a("li",[e._v("/opt/module/zookeeper/server3/data")])])]),e._v(" "),a("li",[e._v("dataLogDir：日志文件\n"),a("ul",[a("li",[e._v("/opt/module/zookeeper/server1/log")]),e._v(" "),a("li",[e._v("/opt/module/zookeeper/server2/log")]),e._v(" "),a("li",[e._v("/opt/module/zookeeper/server3/log")])])]),e._v(" "),a("li",[e._v("集群配置，所有的配置文件都需要不用改动\n"),a("ul",[a("li",[e._v("server.1=127.0.0.1:2888:3888\nserver.2=127.0.0.1:2889:3889\nserver.3=127.0.0.1:2890:3890")])])])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# The number of milliseconds of each tick\ntickTime=2000\n# The number of ticks that the initial\n# synchronization phase can take\ninitLimit=10\n# The number of ticks that can pass between\n# sending a request and getting an acknowledgement\nsyncLimit=5\n# the directory where the snapshot is stored.\n# do not use /tmp for storage, /tmp here is just\n# example sakes.\ndataDir=/opt/module/zookeeper/server1/data\ndataLogDir=/opt/module/zookeeper/server1/log\n# the port at which the clients will connect\nclientPort=2181\n# the maximum number of client connections.\n# increase this if you need to handle more clients\n#maxClientCnxns=60\n#\n# Be sure to read the maintenance section of the\n# administrator guide before turning on autopurge.\n#\n# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance\n#\n# The number of snapshots to retain in dataDir\n#autopurge.snapRetainCount=3\n# Purge task interval in hours\n# Set to "0" to disable auto purge feature\n#autopurge.purgeInterval=1\n\n\n##集群配置\n# The number of ticks that the initial, synchronization phase can take\n# follow服务器在启动的过程中会与leader服务器建立链接并完成对数据的同步，leader服务器允许follow在initLimit时间内完成，默认时10.集群量增大时\n#同步时间变长，有必要适当的调大这个参数, 当超过设置倍数的 tickTime 时间，则连接失败\ninitLimit=10\n#只有集群才需要一下配置\n#server.A=B：C：D：其中 A 数字，表示是第几号服务器. dataDir目录下必有一个myid文件，里面只存\n储A的值,ZK启动时读取此文件，与下面列表比较判断是哪个server\n# B 是服务器 ip ；C表示与 Leader 服务器交换信息的端口；D 表示的是进行选举时的通信端口。\nserver.1=127.0.0.1:2888:3888\nserver.2=127.0.0.1:2889:3889\nserver.3=127.0.0.1:2890:3890\n\n# 配置成observer模式\n#peerType=observer\n# 注意观察者角色的末尾，需要拼接上observer\n#server.4=10.2.143.38:2886:3886:observer\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br"),a("span",{staticClass:"line-number"},[e._v("41")]),a("br"),a("span",{staticClass:"line-number"},[e._v("42")]),a("br"),a("span",{staticClass:"line-number"},[e._v("43")]),a("br"),a("span",{staticClass:"line-number"},[e._v("44")]),a("br"),a("span",{staticClass:"line-number"},[e._v("45")]),a("br"),a("span",{staticClass:"line-number"},[e._v("46")]),a("br"),a("span",{staticClass:"line-number"},[e._v("47")]),a("br"),a("span",{staticClass:"line-number"},[e._v("48")]),a("br")])]),a("h3",{attrs:{id:"_5-复制到server2、server3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-复制到server2、server3"}},[e._v("#")]),e._v(" 5.复制到server2、server3")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cp -r ./zookeeper-3.4.14 /opt/module/zookeeper/server2/\ncp -r ./zookeeper-3.4.14 /opt/module/zookeeper/server3/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("修改配置文件即可")]),e._v(" "),a("h3",{attrs:{id:"_6-启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-启动"}},[e._v("#")]),e._v(" 6.启动")]),e._v(" "),a("h4",{attrs:{id:"方式一-依次进入配置文件中启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式一-依次进入配置文件中启动服务"}},[e._v("#")]),e._v(" 方式一：依次进入配置文件中启动服务")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("./zkServer.sh start\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"方式二-通过sh文件来启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式二-通过sh文件来启动"}},[e._v("#")]),e._v(" 方式二：通过sh文件来启动")]),e._v(" "),a("p",[e._v("1.新增bat文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('#!/bin/bash\n\nif [ "$1" = "" ];\nthen\n    echo -e "\\033[0;31m 未输入操作名 \\033[0m  \\033[0;34m {start|stop|status} \\033[0m"\n    exit 1\nfi\n\nfunction start()\n{\n\tserver1/zookeeper-3.4.14/bin/zkServer.sh start\n\tserver2/zookeeper-3.4.14/bin/zkServer.sh start\n\tserver3/zookeeper-3.4.14/bin/zkServer.sh start\n}\n\nfunction stop()\n{\n\tserver1/zookeeper-3.4.14/bin/zkServer.sh stop\n\tserver2/zookeeper-3.4.14/bin/zkServer.sh stop\n\tserver3/zookeeper-3.4.14/bin/zkServer.sh stop\n}\n\n\nfunction status()\n{\n\tserver1/zookeeper-3.4.14/bin/zkServer.sh status\n\tserver2/zookeeper-3.4.14/bin/zkServer.sh status\n\tserver3/zookeeper-3.4.14/bin/zkServer.sh status\n}\n\ncase $1 in\n    start)\n    start;;\n    stop)\n    stop;;\n    status)\n    status;;\n    *)\n\nesac\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br")])]),a("p",[e._v("2.放到server1同一目录")]),e._v(" "),a("p",[e._v("3.给权限")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("chmod +x zkStart.sh\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("4.转化文件，通过wind10编辑后放入到linux，会出现文件格式不对")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('sed -i "s/\\r//" zkStart.sh\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"_7-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-测试"}},[e._v("#")]),e._v(" 7.测试")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("jps\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h2",{attrs:{id:"_4-zookeeper使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-zookeeper使用"}},[e._v("#")]),e._v(" 4.Zookeeper使用")]),e._v(" "),a("p",[e._v("通过 ./zkCli.sh 进入客户端后，就可以使用命令来操作zookeeper了。")]),e._v(" "),a("h3",{attrs:{id:"_0-展示节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0-展示节点"}},[e._v("#")]),e._v(" 0.展示节点")]),e._v(" "),a("p",[e._v("一定要有/")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ls / \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1-创建节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建节点"}},[e._v("#")]),e._v(" 1.创建节点")]),e._v(" "),a("p",[e._v("使用create命令，可以创建一个zookeeper节点。")]),e._v(" "),a("p",[e._v("create [-s]  [-e] path data acl")]),e._v(" "),a("p",[e._v("其中-s表示顺序节点，-e表示临时节点。默认情况下，创建的是持久节点。")]),e._v(" "),a("p",[e._v("path是节点路径，data是节点数据，acl是用来进行权限控制的。")]),e._v(" "),a("p",[e._v("如下：")]),e._v(" "),a("p",[e._v('创建一个叫做/zk-test的节点，内容是"123"')]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 0] create /zk-test 123\nCreated /zk-test\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v('创建/zk-test的子节点book，内容是"233"')]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 7] create  /zk-test/book  233\nCreated /zk-test/book\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-查看节点内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看节点内容"}},[e._v("#")]),e._v(" 2.查看节点内容")]),e._v(" "),a("p",[e._v("使用get命令，可以获取zookeeper指定节点的内容和属性信息。")]),e._v(" "),a("p",[e._v("如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 1] get /zk-test\n123\ncZxid = 0x3a\nctime = Sun Nov 11 21:50:44 CST 2018\nmZxid = 0x3a\nmtime = Sun Nov 11 21:50:44 CST 2018\npZxid = 0x3a\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 3\nnumChildren = 0\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("h3",{attrs:{id:"_3-查看子节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-查看子节点"}},[e._v("#")]),e._v(" 3.查看子节点")]),e._v(" "),a("p",[e._v("使用ls命令可以查看指定节点下的所有子节点")]),e._v(" "),a("p",[e._v("以下查看根目录下的所有子节点：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 2] ls /\n[zk-test, zookeeper]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("查看zk-test节点的子节点：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 3] ls /zk-test\n[book]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-更新节点内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-更新节点内容"}},[e._v("#")]),e._v(" 4.更新节点内容")]),e._v(" "),a("p",[e._v("使用set命令，更新节点内容。格式为：")]),e._v(" "),a("p",[e._v("set  path data")]),e._v(" "),a("p",[e._v("其中的data就是要更新的新内容。")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 4] set /zk-test 456\n\ncZxid = 0x3a\nctime = Sun Nov 11 21:50:44 CST 2018\nmZxid = 0x3b\nmtime = Sun Nov 11 22:05:20 CST 2018\npZxid = 0x3a\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 3\nnumChildren = 0\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("p",[e._v("在输出的信息中，可以发现，dataVersion的值由原来的0 变成了 1，这是因为刚才的更新操作导致该节点的数据版本也发生变更。")]),e._v(" "),a("h3",{attrs:{id:"_6-删除节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-删除节点"}},[e._v("#")]),e._v(" 6.删除节点")]),e._v(" "),a("p",[e._v("使用delete命令来删除节点，如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 11] delete /zk-test\nNode not empty: /zk-test\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("可以发现，一个节点存在子节点时，无法删除该节点。")]),e._v(" "),a("p",[e._v("删除子节点/zk-test/book，如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 12] delete /zk-test/book\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:NodeDeleted path:/zk-test/book\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("zookeeper中的watcher会监控节点，当子节点发生变化时会发出通知。此时提示子节点 /zk-test/book删除成功。")]),e._v(" "),a("p",[e._v("继续尝试删除节点 /zk-test，")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[zk: localhost:2181(CONNECTED) 13] ls /zk-test\n[]\n[zk: localhost:2181(CONNECTED) 14] delete /zk-test\n[zk: localhost:2181(CONNECTED) 15] ls /\n[]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("删除成功。")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ******************************************************************************************************************")]),e._v(" "),a("h2",{attrs:{id:"_4-springcloud整合zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-springcloud整合zookeeper"}},[e._v("#")]),e._v(" 4.SpringCloud整合Zookeeper")]),e._v(" "),a("p",[e._v("注意：")]),e._v(" "),a("p",[e._v("zookeeper作为服务注册中心，微服务作为节点注册进来，那这个节点是临时还是持久？\n关于Eureka我们知道，偶尔有一时刻服务提供者出了点故障，Eureka会开启自我保护机制，微服务不会被删除，那现在关闭8004试一下zookeeper中的服务会有什么变化吗？")]),e._v(" "),a("p",[a("strong",[e._v("可以看出，Zookeeper也是在一定时间内，不会剔除服务，超时才剔除，所以zookeeper具备的服务节点是临时的。当你再启动8004时，zookeeper还会自动监听服务状态，但是流水号是一个新的流水号。")])]),e._v(" "),a("p",[a("strong",[e._v("（临时节点:心跳未及时反馈及删除）")])]),e._v(" "),a("p",[a("strong",[e._v("记得关闭防火墙：systemctl stop firewalld")])]),e._v(" "),a("h3",{attrs:{id:"_1-增加生产者模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-增加生产者模块"}},[e._v("#")]),e._v(" 1.增加生产者模块：")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("新建模块：cloud-provider-payment8004")])]),e._v(" "),a("li",[a("p",[e._v("修改pom文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>CloudStudy</artifactId>\n        <groupId>com.wcy.springcloud</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>cloud-provider-payment8004</artifactId>\n\n    <dependencies>\n        \x3c!-- SpringBoot整合zookeeper客户端 --\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>\n        </dependency>\n\n        \x3c!-- SpringBoot整合Web组件 --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\x3c!-- 引入自己定义的api通用包，可以使用Payment支付Entity --\x3e\n            <groupId>com.wcy.springcloud</groupId>\n            <artifactId>cloud-api-commons</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <scope>runtime</scope>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n</project>\n\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br"),a("span",{staticClass:"line-number"},[e._v("41")]),a("br"),a("span",{staticClass:"line-number"},[e._v("42")]),a("br"),a("span",{staticClass:"line-number"},[e._v("43")]),a("br"),a("span",{staticClass:"line-number"},[e._v("44")]),a("br"),a("span",{staticClass:"line-number"},[e._v("45")]),a("br"),a("span",{staticClass:"line-number"},[e._v("46")]),a("br"),a("span",{staticClass:"line-number"},[e._v("47")]),a("br"),a("span",{staticClass:"line-number"},[e._v("48")]),a("br"),a("span",{staticClass:"line-number"},[e._v("49")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("修改yml文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#8004表示注册到zookeeper服务器的支付服务提供者端口号\nserver:\n  port: 8004\n#服务别名----注册zookeeper到注册中心名称\nspring:\n  application:\n    name: cloud-provider-payment   #服务注册的别名\n  cloud:\n    zookeeper:\n      connect-string: 192.168.2.210:2181\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("启动类")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("package com.wcy.springcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient //该注解用于向使用consul或者zookeeper作为注册中心时注册服务\npublic class PaymentZookeeperMain8004 {\n    public static void main(String[] args) {\n        SpringApplication.run(PaymentZookeeperMain8004.class,args);\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("测试")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('package com.wcy.springcloud.controller;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.UUID;\n\n@RestController\npublic class PaymentController {\n    @Value("${server.port}")\n    private String serverPort;\n\n    @GetMapping("/payment.zk")\n    public String getZk(){\n        return "springcloud with zookeeper: "+serverPort+"\\t"+ UUID.randomUUID().toString();\n    }\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("启动服务报错：")]),e._v(" "),a("p",[e._v("由于spring-cloud-starter-zookeeper-discovery自带的zookeeper版本是3.5.3，而我们下周的zookeeper版本是3.4.14")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:99) ~[zookeeper-3.5.3-beta.jar:3.5.3-beta-8ce24f9e675cbefffb8f21a47e06b42864475a60]\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.checkBackgroundRetry(CuratorFrameworkImpl.java:844) [curator-framework-4.0.1.jar:4.0.1]\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.performBackgroundOperation(CuratorFrameworkImpl.java:972) [curator-framework-4.0.1.jar:4.0.1]\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.backgroundOperationsLoop(CuratorFrameworkImpl.java:925) [curator-framework-4.0.1.jar:4.0.1]\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.access$300(CuratorFrameworkImpl.java:73) [curator-framework-4.0.1.jar:4.0.1]\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl$4.call(CuratorFrameworkImpl.java:322) [curator-framework-4.0.1.jar:4.0.1]\n\tat java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:266) [na:1.8.0_40]\n\tat java.util.concurrent.FutureTask.run(FutureTask.java) [na:1.8.0_40]\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [na:1.8.0_40]\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [na:1.8.0_40]\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_40]\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_40]\n\tat java.lang.Thread.run(Thread.java:745) [na:1.8.0_40]\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])]),a("p",[e._v("解决：排除自带的依赖，导入对应的版本")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("        \x3c!-- SpringBoot整合zookeeper客户端 --\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>\n            \x3c!--先排除自带的zookeeper3.5.3--\x3e\n            <exclusions>\n                <exclusion>\n                    <groupId>org.apache.zookeeper</groupId>\n                    <artifactId>zookeeper</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n        \x3c!--添加zookeeper3.4.9版本--\x3e\n        <dependency>\n            <groupId>org.apache.zookeeper</groupId>\n            <artifactId>zookeeper</artifactId>\n            <version>3.4.14</version>\n        </dependency>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br")])]),a("p",[a("strong",[e._v("PS： 新版本的zookeeper还会遇到slf4j和log4j包冲突的问题，此时在zookeeper去掉slf4j的依赖")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<dependency>\n\t<groupId>org.apache.zookeeper</groupId>\n    \t<artifactId>zookeeper</artifactId>\n        <version>3.4.14</version>\n        <exclusions>\n        \t<exclusion>\n            \t<groupId>log4j</groupId>\n                <artifactId>log4j</artifactId>\n            </exclusion>\n            <exclusion>\n            \t<groupId>org.slf4j</groupId>\n                <artifactId>slf4j-log4j12</artifactId>\n            </exclusion>\n     </exclusions>\n</dependency>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("在linux中操作查看微服务是否注册成功")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("进入zookeeper客户端\n./zkCli.sh\nget /services/cloud-provider-payment/XXX字符串\n得到一组数据，json在线转换工具查看即可\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])])])]),e._v(" "),a("h3",{attrs:{id:"_2-增加消费者模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-增加消费者模块"}},[e._v("#")]),e._v(" 2.增加消费者模块：")]),e._v(" "),a("p",[e._v("与上方增加生产者模块相同，通过RestTemplate调用生产者服务即可")])])}),[],!1,null,null,null);s.default=r.exports}}]);