(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{488:function(s,a,n){"use strict";n.r(a);var e=n(8),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"springcloud-alibaba-nacos服务注册和配置中心"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springcloud-alibaba-nacos服务注册和配置中心"}},[s._v("#")]),s._v(" SpringCloud alibaba Nacos服务注册和配置中心")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://nacos.io/zh-cn/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/alibaba/Nacos",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网源码"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery",target:"_blank",rel:"noopener noreferrer"}},[s._v("开发文档"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"_1-为什么叫nacos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么叫nacos"}},[s._v("#")]),s._v(" 1.为什么叫Nacos")]),s._v(" "),n("p",[s._v("前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service。")]),s._v(" "),n("h2",{attrs:{id:"_2-nacos是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-nacos是什么"}},[s._v("#")]),s._v(" 2.Nacos是什么")]),s._v(" "),n("ul",[n("li",[s._v("一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。")]),s._v(" "),n("li",[s._v("Nacos: Dynamic Naming and Configuration Service")]),s._v(" "),n("li",[s._v("Nacos就是注册中心 + 配置中心的组合========》Nacos = Eureka+Config +Bus")])]),s._v(" "),n("h2",{attrs:{id:"_3-nacos能干嘛"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-nacos能干嘛"}},[s._v("#")]),s._v(" 3.Nacos能干嘛")]),s._v(" "),n("ul",[n("li",[s._v("替代Eureka做服务注册中心")]),s._v(" "),n("li",[s._v("替代Config做服务配置中心")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210826145828566.png",alt:"image-20210826145828566"}})]),s._v(" "),n("h2",{attrs:{id:"_4-nacos下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-nacos下载"}},[s._v("#")]),s._v(" 4.Nacos下载")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("启动startup.cmd即可")]),s._v(" "),n("p",[s._v("访问地址：http://localhost:8848/nacos")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("linux启动\n./startup.sh -m standalone\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"_5-nacos作为服务注册中心演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-nacos作为服务注册中心演示"}},[s._v("#")]),s._v(" 5.Nacos作为服务注册中心演示")]),s._v(" "),n("h3",{attrs:{id:"_1-基于nacos的服务提供者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-基于nacos的服务提供者"}},[s._v("#")]),s._v(" 1.基于Nacos的服务提供者")]),s._v(" "),n("h4",{attrs:{id:"_1-新建模块-cloudalibaba-provider-payment9001"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-新建模块-cloudalibaba-provider-payment9001"}},[s._v("#")]),s._v(" 1.新建模块：cloudalibaba-provider-payment9001")]),s._v(" "),n("h4",{attrs:{id:"_2-引入依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-引入依赖"}},[s._v("#")]),s._v(" 2.引入依赖")]),s._v(" "),n("p",[s._v("父pom：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n  <modelVersion>4.0.0</modelVersion>\n\n  <groupId>com.wcy.springcloud</groupId>\n  <artifactId>CloudStudy</artifactId>\n  <version>1.0-SNAPSHOT</version>\n  \x3c!--父工程就是一个maven管理，打包方式为pom--\x3e\n  <packaging>pom</packaging>\n\n  <modules>\n      <module>cloud-provider-payment8001</module>\n      <module>cloud-consumer-order80</module>\n      <module>cloud-api-commons</module>\n      <module>cloud-eureka-server7001</module>\n      <module>cloud-eureka-server7002</module>\n      <module>cloud-provider-payment8002</module>\n      <module>cloud-provider-payment8004</module>\n      <module>cloud-consumerzk-order80</module>\n      <module>cloud-providerconsul-payment8006</module>\n      <module>cloud-consumerconsul-order80</module>\n      <module>cloud-consumer-feign-order80</module>\n      <module>cloud-provider-hystrix-payment8001</module>\n      <module>cloud-consumer-feign-hystrix-order80</module>\n      <module>cloud-consumer-hystrix-dashboard9001</module>\n      <module>cloud-gateway-gateway9527</module>\n      <module>cloud-config-center-3344</module>\n    <module>cloud-config-client-3355</module>\n      <module>cloud-config-client-3366</module>\n      <module>cloud-stream-rabbitmq-provider8801</module>\n      <module>cloud-stream-rabbitmq-consumer8802</module>\n      <module>cloud-stream-rabbitmq-consumer8803</module>\n    <module>cloudalibaba-provider-payment9001</module>\n  </modules>\n\n  \x3c!-- 统一管理jar包版本 --\x3e\n  <properties>\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    <maven.compiler.source>1.8</maven.compiler.source>\n    <maven.compiler.target>1.8</maven.compiler.target>\n    <junit.version>4.12</junit.version>\n    <log4j.version>1.2.17</log4j.version>\n    <lombok.version>1.16.18</lombok.version>\n    <mysql.version>5.1.47</mysql.version>\n    <druid.version>1.1.16</druid.version>\n    <mybatis.spring.boot.version>1.3.0</mybatis.spring.boot.version>\n  </properties>\n\n  \x3c!-- 子模块继承之后，提供作用：锁定版本+子modlue不用写groupId和version  --\x3e\n  <dependencyManagement>\n    <dependencies>\n      \x3c!--spring boot 2.2.2--\x3e\n      <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-dependencies</artifactId>\n        <version>2.2.2.RELEASE</version>\n        <type>pom</type>\n        <scope>import</scope>\n      </dependency>\n      \x3c!--spring cloud Hoxton.SR1--\x3e\n      <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-dependencies</artifactId>\n        <version>Hoxton.SR1</version>\n        <type>pom</type>\n        <scope>import</scope>\n      </dependency>\n      \x3c!--spring cloud alibaba 2.1.0.RELEASE--\x3e\n      <dependency>\n        <groupId>com.alibaba.cloud</groupId>\n        <artifactId>spring-cloud-alibaba-dependencies</artifactId>\n        <version>2.1.0.RELEASE</version>\n        <type>pom</type>\n        <scope>import</scope>\n      </dependency>\n      <dependency>\n        <groupId>mysql</groupId>\n        <artifactId>mysql-connector-java</artifactId>\n        <version>${mysql.version}</version>\n      </dependency>\n      <dependency>\n        <groupId>com.alibaba</groupId>\n        <artifactId>druid</artifactId>\n        <version>${druid.version}</version>\n      </dependency>\n      <dependency>\n        <groupId>org.mybatis.spring.boot</groupId>\n        <artifactId>mybatis-spring-boot-starter</artifactId>\n        <version>${mybatis.spring.boot.version}</version>\n      </dependency>\n      <dependency>\n        <groupId>junit</groupId>\n        <artifactId>junit</artifactId>\n        <version>${junit.version}</version>\n      </dependency>\n      <dependency>\n        <groupId>log4j</groupId>\n        <artifactId>log4j</artifactId>\n        <version>${log4j.version}</version>\n      </dependency>\n      <dependency>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n        <version>${lombok.version}</version>\n        <optional>true</optional>\n      </dependency>\n    </dependencies>\n  </dependencyManagement>\n\n  <build>\n    <plugins>\n      <plugin>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-maven-plugin</artifactId>\n        <configuration>\n          <fork>true</fork>\n          <addResources>true</addResources>\n        </configuration>\n      </plugin>\n    </plugins>\n  </build>\n</project>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br")])]),n("p",[s._v("子pom：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>CloudStudy</artifactId>\n        <groupId>com.wcy.springcloud</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>cloudalibaba-provider-payment9001</artifactId>\n\n    <dependencies>\n        \x3c!--SpringCloud ailibaba nacos --\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n        \x3c!-- SpringBoot整合Web组件 --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n        \x3c!--日常通用jar包配置--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <scope>runtime</scope>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n</project>\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])]),n("h4",{attrs:{id:"_3-yml文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-yml文件"}},[s._v("#")]),s._v(" 3.yml文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server:\n  port: 9001\n\nspring:\n  application:\n    name: nacos-payment-provider\n  cloud:\n    nacos:\n      discovery:\n        server-addr: localhost:8848 #配置Nacos地址\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: '*'\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h4",{attrs:{id:"_4-主启动类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-主启动类"}},[s._v("#")]),s._v(" 4.主启动类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package com.wcy.springcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class PaymentMain9001\n{\n    public static void main(String[] args) {\n        SpringApplication.run(PaymentMain9001.class, args);\n    }\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h4",{attrs:{id:"_5-controller类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-controller类"}},[s._v("#")]),s._v(" 5.controller类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package com.wcy.springcloud.controller;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class PaymentController\n{\n    @Value("${server.port}")\n    private String serverPort;\n\n    @GetMapping(value = "/payment/nacos/{id}")\n    public String getPayment(@PathVariable("id") Integer id)\n    {\n        return "nacos registry, serverPort: "+ serverPort+"\\t id"+id;\n    }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h4",{attrs:{id:"_6-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-测试"}},[s._v("#")]),s._v(" 6.测试")]),s._v(" "),n("ul",[n("li",[s._v("启动Nacos")]),s._v(" "),n("li",[s._v("启动9001")])]),s._v(" "),n("p",[s._v("访问地址：http://localhost:9001/payment/nacos/1")]),s._v(" "),n("p",[s._v("查看nacos是否注册服务：http://localhost:8848/nacos")]),s._v(" "),n("h3",{attrs:{id:"_2-演示负载均衡-复制9001端口映射-9011"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-演示负载均衡-复制9001端口映射-9011"}},[s._v("#")]),s._v(" 2.演示负载均衡：复制9001端口映射：9011")]),s._v(" "),n("p",[s._v("不想新建模块，直接拷贝虚拟端口映射")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210826152459815.png",alt:"image-20210826152459815"}})]),s._v(" "),n("h3",{attrs:{id:"_3-基于nacos的服务消费者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-基于nacos的服务消费者"}},[s._v("#")]),s._v(" 3.基于Nacos的服务消费者")]),s._v(" "),n("h4",{attrs:{id:"_1-新建模块-cloudalibaba-consumer-nacos-order83"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-新建模块-cloudalibaba-consumer-nacos-order83"}},[s._v("#")]),s._v(" 1.新建模块：cloudalibaba-consumer-nacos-order83")]),s._v(" "),n("h4",{attrs:{id:"_2-导入依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入依赖"}},[s._v("#")]),s._v(" 2.导入依赖")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>CloudStudy</artifactId>\n        <groupId>com.wcy.springcloud</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>cloudalibaba-consumer-nacos-order83</artifactId>\n\n\n    <dependencies>\n        \x3c!--SpringCloud ailibaba nacos --\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n        \x3c!-- 引入自己定义的api通用包，可以使用Payment支付Entity --\x3e\n        <dependency>\n            <groupId>com.wcy.springcloud</groupId>\n            <artifactId>cloud-api-commons</artifactId>\n            <version>${project.version}</version>\n        </dependency>\n        \x3c!-- SpringBoot整合Web组件 --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n        \x3c!--日常通用jar包配置--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <scope>runtime</scope>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n</project>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br")])]),n("h4",{attrs:{id:"_3-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置文件"}},[s._v("#")]),s._v(" 3.配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server:\n  port: 83\n\n\nspring:\n  application:\n    name: nacos-order-consumer\n  cloud:\n    nacos:\n      discovery:\n        server-addr: localhost:8848\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"_4-主启动类-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-主启动类-2"}},[s._v("#")]),s._v(" 4.主启动类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package com.wcy.pringcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class OrderNacosMain83\n{\n    public static void main(String[] args)\n    {\n        SpringApplication.run(OrderNacosMain83.class,args);\n    }\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h4",{attrs:{id:"_5-业务类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-业务类"}},[s._v("#")]),s._v(" 5.业务类")]),s._v(" "),n("p",[s._v("引入RestTemplate")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("@Configuration\npublic class ApplicationContextBean\n{\n    @Bean\n    @LoadBalanced\n    public RestTemplate getRestTemplate()\n    {\n        return new RestTemplate();\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("controller类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package com.wcy.pringcloud.controller;\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.client.RestTemplate;\n\nimport javax.annotation.Resource;\n\n@RestController\npublic class OrderNacosController\n{\n    @Resource\n    private RestTemplate restTemplate;\n\n    private static final String serverURL="http://nacos-payment-provider";\n\n    @GetMapping("/consumer/payment/nacos/{id}")\n    public String paymentInfo(@PathVariable("id") Long id)\n    {\n        return restTemplate.getForObject(serverURL+"/payment/nacos/"+id,String.class);\n    }\n\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h4",{attrs:{id:"_6-测试-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-测试-2"}},[s._v("#")]),s._v(" 6.测试")]),s._v(" "),n("ul",[n("li",[s._v("启动Nacos")]),s._v(" "),n("li",[s._v("启动9001、9011")]),s._v(" "),n("li",[s._v("启动83")])]),s._v(" "),n("p",[s._v("访问地址：http://localhost:83/consumer/payment/nacos/1")]),s._v(" "),n("blockquote",[n("p",[s._v("可以看到已经有自带负载均衡能力")])]),s._v(" "),n("h2",{attrs:{id:"_6-服务注册中心对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-服务注册中心对比"}},[s._v("#")]),s._v(" 6.服务注册中心对比")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210826160602269.png",alt:"image-20210826160602269"}})]),s._v(" "),n("p",[s._v("nacos与启动注册中心的特性对比")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210826160715990.png",alt:"image-20210826160715990"}})]),s._v(" "),n("p",[n("img",{attrs:{src:"C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210826160807521.png",alt:"image-20210826160807521"}})]),s._v(" "),n("p",[s._v("C是所有节点在同一时间看到的数据是一致的；而A的定义是所有的请求都会收到响应。")]),s._v(" "),n("blockquote",[n("p",[s._v("何时选择使用何种模式？\n一般来说：\n如果不需要存储服务级别的信息且服务实例是通过nacos-client注册，并能够保持心跳上报，那么就可以选择AP模式。当前主流的服务如 Spring cloud 和 Dubbo 服务，都适用于AP模式，AP模式为了服务的可能性而减弱了一致性，因此AP模式下只支持注册临时实例。")]),s._v(" "),n("p",[s._v("如果需要在服务级别编辑或者存储配置信息，那么 CP 是必须，K8S服务和DNS服务则适用于CP模式。\nCP模式下则支持注册持久化实例，此时则是以 Raft 协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。")])]),s._v(" "),n("p",[s._v("发送请求切换CP和AP：默认AP")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&value=CP'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"_7-nacos作为配置中心-基础配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-nacos作为配置中心-基础配置"}},[s._v("#")]),s._v(" 7.Nacos作为配置中心-基础配置")]),s._v(" "),n("h3",{attrs:{id:"_1-新建模块-cloudalibaba-config-nacos-client3377"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-新建模块-cloudalibaba-config-nacos-client3377"}},[s._v("#")]),s._v(" 1.新建模块：cloudalibaba-config-nacos-client3377")]),s._v(" "),n("h3",{attrs:{id:"_2-导入依赖-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入依赖-2"}},[s._v("#")]),s._v(" 2.导入依赖")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>CloudStudy</artifactId>\n        <groupId>com.wcy.springcloud</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>cloudalibaba-config-nacos-client3377</artifactId>\n\n    <dependencies>\n        \x3c!--nacos-config--\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>\n        </dependency>\n        \x3c!--nacos-discovery--\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n        \x3c!--web + actuator--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n        \x3c!--一般基础配置--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <scope>runtime</scope>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n</project>\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br")])]),n("h3",{attrs:{id:"_3-yml配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-yml配置文件"}},[s._v("#")]),s._v(" 3.yml配置文件")]),s._v(" "),n("blockquote",[n("p",[s._v("Nacos同springcloud-config一样，在项目初始化时，要保证先从配置中心进行配置拉取，\n拉取配置之后，才能保证项目的正常启动。")]),s._v(" "),n("p",[s._v("springboot中配置文件的加载是存在优先级顺序的，bootstrap优先级高于application")])]),s._v(" "),n("p",[s._v("bootstrap.yml文件配置：")]),s._v(" "),n("ul",[n("li",[s._v("指定nacos注册中心")]),s._v(" "),n("li",[s._v("指定nacos配置中心")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# nacos配置\nserver:\n  port: 3377\n\nspring:\n  application:\n    name: nacos-config-client\n  cloud:\n    nacos:\n      discovery:\n        server-addr: localhost:8848 #Nacos服务注册中心地址\n      config:\n        server-addr: localhost:8848 #Nacos作为配置中心地址\n        file-extension: yaml #指定yaml格式的配置  一定要写成yaml  nacos的bug\n\n\n# ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file-extension}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("application.yml配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\nspring:\n  profiles:\n    active: dev # 表示开发环境\n \n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"_4-主启动类-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-主启动类-3"}},[s._v("#")]),s._v(" 4.主启动类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("package com.wcy.springcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class NacosConfigClientMain3377\n{\n    public static void main(String[] args) {\n        SpringApplication.run(NacosConfigClientMain3377.class, args);\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"_5-controller层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-controller层"}},[s._v("#")]),s._v(" 5.controller层")]),s._v(" "),n("ul",[n("li",[s._v("@RefreshScope：自动刷新功能，通过nacos实现动态刷新")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package com.wcy.springcloud.controller;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.cloud.context.config.annotation.RefreshScope;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\n@RefreshScope //在控制器类加入@RefreshScope注解使当前类下的配置支持Nacos的动态刷新功能。\npublic class ConfigClientController\n{\n    @Value("${config.info}")\n    private String configInfo;\n\n    @GetMapping("/config/info")\n    public String getConfigInfo() {\n        return configInfo;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"_6-在nacos中添加配置信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-在nacos中添加配置信息"}},[s._v("#")]),s._v(" 6.在Nacos中添加配置信息")]),s._v(" "),n("p",[s._v("Nacos中的匹配规则：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210826171217890.png",alt:"image-20210826171217890"}})]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("Data ID")]),s._v("公式：${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}")]),s._v(" "),n("p",[s._v("微服务名-profiles.yaml：注意一定要写成yaml，nacos的BUG")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wangchangyin/images@main/hand/image-20210826171248149.png",alt:"image-20210826171248149"}})]),s._v(" "),n("p",[s._v("登录nacos新建配置：")]),s._v(" "),n("ul",[n("li",[s._v("一定要注意Data ID最后文件格式必须为yaml")])]),s._v(" "),n("p",[n("img",{attrs:{src:"C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210826172102834.png",alt:"image-20210826172102834"}})]),s._v(" "),n("h3",{attrs:{id:"_7-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-测试"}},[s._v("#")]),s._v(" 7.测试")]),s._v(" "),n("ul",[n("li",[s._v("启动nacos")]),s._v(" "),n("li",[s._v("启动3377")])]),s._v(" "),n("p",[s._v("访问地址：http://localhost:3377/config/info")]),s._v(" "),n("h2",{attrs:{id:"_8-nacos作为配置中心-分类配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-nacos作为配置中心-分类配置"}},[s._v("#")]),s._v(" 8.Nacos作为配置中心-分类配置")]),s._v(" "),n("p",[s._v("问题1：")]),s._v(" "),n("blockquote",[n("p",[s._v("实际开发中，通常一个系统会准备\ndev开发环境\ntest测试环境\nprod生产环境。\n如何保证指定环境启动时服务能正确读取到Nacos上相应环境的配置文件呢？")])]),s._v(" "),n("p",[s._v("问题2：")]),s._v(" "),n("blockquote",[n("p",[s._v("一个大型分布式微服务系统会有很多微服务子项目，\n每个微服务项目又都会有相应的开发环境、测试环境、预发环境、正式环境......\n那怎么对这些微服务配置进行管理呢？")])]),s._v(" "),n("p",[s._v("nacos的配置列表和命令空间：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827162416788.png",alt:"image-20210827162416788"}})]),s._v(" "),n("h3",{attrs:{id:"_1-namespace-group-data-id三者关系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-namespace-group-data-id三者关系"}},[s._v("#")]),s._v(" 1.Namespace+Group+Data ID三者关系？")]),s._v(" "),n("h4",{attrs:{id:"_1-namespace-group-data-id是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-namespace-group-data-id是什么"}},[s._v("#")]),s._v(" 1 Namespace+Group+Data ID是什么")]),s._v(" "),n("p",[s._v("类似Java里面的package名和类名\n最外层的namespace是可以用于区分部署环境的，Group和DataID逻辑上区分两个目标对象。")]),s._v(" "),n("h4",{attrs:{id:"_2-三者情况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-三者情况"}},[s._v("#")]),s._v(" 2 三者情况")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827162534723.png",alt:"image-20210827162534723"}}),s._v("\n默认情况：")]),s._v(" "),n("blockquote",[n("p",[s._v("Namespace=public，Group=DEFAULT_GROUP, 默认Cluster是DEFAULT")])]),s._v(" "),n("p",[s._v("Nacos默认的命名空间是public，Namespace主要用来实现隔离。\n比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个Namespace，不同的Namespace之间是隔离的。")]),s._v(" "),n("p",[s._v("Group默认是DEFAULT_GROUP，Group可以把不同的微服务划分到同一个分组里面去")]),s._v(" "),n("p",[s._v("Service就是微服务；一个Service可以包含多个Cluster（集群），Nacos默认Cluster是DEFAULT，Cluster是对指定微服务的一个虚拟划分。\n比方说为了容灾，将Service微服务分别部署在了杭州机房和广州机房，\n这时就可以给杭州机房的Service微服务起一个集群名称（HZ），\n给广州机房的Service微服务起一个集群名称（GZ），还可以尽量让同一个机房的微服务互相调用，以提升性能。")]),s._v(" "),n("p",[s._v("最后是Instance，就是微服务的实例。")]),s._v(" "),n("h3",{attrs:{id:"_2-dataid配置方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-dataid配置方案"}},[s._v("#")]),s._v(" 2.DataID配置方案")]),s._v(" "),n("p",[s._v("根据微服务名-${spring.profile.active}.yaml来实现")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827163834196.png",alt:"image-20210827163834196"}})]),s._v(" "),n("p",[s._v("修改配置文件的active即可实现开发环境的区分：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827163912038.png",alt:"image-20210827163912038"}})]),s._v(" "),n("p",[s._v("测试访问：http://localhost:3377/config/info")]),s._v(" "),n("h3",{attrs:{id:"_3-group方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-group方案"}},[s._v("#")]),s._v(" 3.Group方案")]),s._v(" "),n("p",[s._v("nacos新建相同Data ID不同的组：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827164729301.png",alt:"image-20210827164729301"}})]),s._v(" "),n("p",[s._v("配置文件中指定使用哪个组的配置问题：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827164811479.png",alt:"image-20210827164811479"}})]),s._v(" "),n("p",[s._v("测试访问：http://localhost:3377/config/info")]),s._v(" "),n("h3",{attrs:{id:"_4-namespace方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-namespace方案"}},[s._v("#")]),s._v(" 4.Namespace方案")]),s._v(" "),n("p",[s._v("nacos新建两个Namespace：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827165612307.png",alt:"image-20210827165612307"}})]),s._v(" "),n("p",[s._v("nacos在NameSpace为dev下创建三个配置文件：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827165924450.png",alt:"image-20210827165924450"}})]),s._v(" "),n("p",[s._v("配置文件：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210827170134936.png",alt:"image-20210827170134936"}})]),s._v(" "),n("p",[s._v("测试访问：http://localhost:3377/config/info")]),s._v(" "),n("h2",{attrs:{id:"_9-nacos持久化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-nacos持久化"}},[s._v("#")]),s._v(" 9.nacos持久化")]),s._v(" "),n("p",[s._v("nacos架构：")]),s._v(" "),n("p",[n("img",{attrs:{src:"C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210830111437595.png",alt:"image-20210830111437595"}})]),s._v(" "),n("blockquote",[n("p",[s._v("Nacos默认自带的是嵌入式数据库"),n("code",[s._v("derby")]),s._v("；")]),s._v(" "),n("p",[s._v("默认Nacos使用嵌入式数据库实现数据的存储。所以，如果启动多个默认配置下的Nacos节点，数据存储是存在一致性问题的。")]),s._v(" "),n("p",[s._v("为了解决这个问题，Nacos采用了集中式存储的方式来支持集群化部署，目前只支持MySQL的存储。")])]),s._v(" "),n("p",[s._v("在0.7版本之前，在单机模式时nacos使用嵌入式数据库实现数据的存储，不方便观察数据存储的基本情况。0.7版本增加了支持mysql数据源能力，具体的操作步骤：")]),s._v(" "),n("ul",[n("li",[s._v("1.安装数据库，版本要求：5.6.5+")]),s._v(" "),n("li",[s._v("2.初始化mysql数据库，数据库初始化文件：nacos-mysql.sql")]),s._v(" "),n("li",[s._v("3.修改conf/application.properties文件，增加支持mysql数据源配置（目前只支持mysql），添加mysql数据源的url、用户名和密码。")])]),s._v(" "),n("h3",{attrs:{id:"_1-准备mysql数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备mysql数据库"}},[s._v("#")]),s._v(" 1.准备mysql数据库")]),s._v(" "),n("h3",{attrs:{id:"_2-sql脚本导入mysql数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-sql脚本导入mysql数据库"}},[s._v("#")]),s._v(" 2.sql脚本导入mysql数据库")]),s._v(" "),n("p",[s._v("脚本路径：nacos-server-1.1.4\\nacos\\conf\\nacos-mysql.sql")]),s._v(" "),n("p",[s._v("新建数据库：nacos_config")]),s._v(" "),n("h3",{attrs:{id:"_3-修改nacos配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改nacos配置文件"}},[s._v("#")]),s._v(" 3.修改nacos配置文件")]),s._v(" "),n("p",[s._v("位置：nacos-server-1.1.4\\nacos\\conf\\application.properties")]),s._v(" "),n("p",[s._v("添加内容：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("spring.datasource.platform=mysql\n \ndb.num=1\ndb.url.0=jdbc:mysql://192.168.188.128:3306/nacos_config?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true\ndb.user=root\ndb.password=2452952178\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"_10-linux集群nacos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-linux集群nacos"}},[s._v("#")]),s._v(" 10.linux集群nacos")]),s._v(" "),n("h3",{attrs:{id:"_1-环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境准备"}},[s._v("#")]),s._v(" 1.环境准备")]),s._v(" "),n("ul",[n("li",[s._v("linux环境")]),s._v(" "),n("li",[s._v("JDK1.8+")]),s._v(" "),n("li",[s._v("Maven3.2")]),s._v(" "),n("li",[s._v("3个或3个以上nacos节点才能构成集群")]),s._v(" "),n("li",[s._v("mysql")]),s._v(" "),n("li",[s._v("nginx")])]),s._v(" "),n("h3",{attrs:{id:"_2-linux下载nacos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-linux下载nacos"}},[s._v("#")]),s._v(" 2.linux下载nacos")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/alibaba/nacos/releases/tag/1.1.4",target:"_blank",rel:"noopener noreferrer"}},[s._v("地址"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("对应版本：nacos-1.1.4.tar.gz")]),s._v(" "),n("h3",{attrs:{id:"_3-解压"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-解压"}},[s._v("#")]),s._v(" 3.解压")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("tar -zxvf nacos-server-1.1.4.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_4-移动位置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-移动位置"}},[s._v("#")]),s._v(" 4.移动位置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp -r nacos /opt/module/nacos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_5-linux服务器上mysql数据库配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-linux服务器上mysql数据库配置"}},[s._v("#")]),s._v(" 5.Linux服务器上mysql数据库配置")]),s._v(" "),n("p",[s._v("1.首先执行mysql脚本")]),s._v(" "),n("h3",{attrs:{id:"_6-application-properties-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-application-properties-配置"}},[s._v("#")]),s._v(" 6.application.properties 配置")]),s._v(" "),n("p",[s._v("1.进入路径/opt/module/nacos/conf/")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /opt/module/nacos/conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("2.备份配置文件，害怕可能修改错误")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp application.properties application.properties.bf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3.修改配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vi application.properties\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("4.内容")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("spring.datasource.platform=mysql\n\ndb.num=1\ndb.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true\ndb.user=root\ndb.password=2452952178\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"_7-linux服务器上nacos的集群配置cluster-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-linux服务器上nacos的集群配置cluster-conf"}},[s._v("#")]),s._v(" 7.Linux服务器上nacos的集群配置cluster.conf")]),s._v(" "),n("p",[s._v("1.同理：备份cluster.conf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp cluster.conf.example cluster.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("2.修改cluster.conf")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vi cluster.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3.修改内容：")]),s._v(" "),n("blockquote",[n("p",[s._v("这个IP不能写127.0.0.1，必须是\nLinux命令hostname -I能够识别的IP")]),s._v(" "),n("p",[n("strong",[s._v("一定要配置正确")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("192.168.188.128:3333\n192.168.188.128:4444\n192.168.188.128:5555\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_8-编辑nacos的启动脚本startup-sh-使它能够接受不同的启动端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-编辑nacos的启动脚本startup-sh-使它能够接受不同的启动端口"}},[s._v("#")]),s._v(" 8.编辑Nacos的启动脚本startup.sh，使它能够接受不同的启动端口")]),s._v(" "),n("blockquote",[n("p",[s._v("平时单机版的启动，都是./startup.sh即可。")]),s._v(" "),n("p",[s._v("但是：")]),s._v(" "),n("p",[s._v("集群启动，我们希望可以类似其它软件的shell命令，传递不同的端口号启动不同的nacos实例。\n命令：./startup.sh -p 3333 表示启动端口号为3333的nacos服务器实例，和上一步的cluster.conf配置的一致。")])]),s._v(" "),n("p",[s._v("1.进入目录")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /opt/module/nacos/bin\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("2.备份")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp startup.sh startup.sh.bf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3.修改startup.sh")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vi startup.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("4.修改内容")]),s._v(" "),n("p",[s._v("注意那里是p)")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("修改前")]),s._v(" "),n("th",[s._v("修改后")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210830150318390.png",alt:"image-20210830150318390"}})]),s._v(" "),n("td",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210830150322713.png",alt:"image-20210830150322713"}})])]),s._v(" "),n("tr",[n("td",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210830150332369.png",alt:"image-20210830150332369"}})]),s._v(" "),n("td",[n("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210830150335766.png",alt:"image-20210830150335766"}})])])])]),s._v(" "),n("p",[s._v("5.执行方式：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./startup.sh -p 3333\n./startup.sh -p 4444\n./startup.sh -p 5555\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("查看是否启动\nps -ef|grep nacos|grep -v grep|wc -l\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("6.测试访问地址")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http://192.168.188.128:3333/nacos\nhttp://192.168.188.128:4444/nacos\nhttp://192.168.188.128:5555/nacos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_9-nginx的配置-由它作为负载均衡器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-nginx的配置-由它作为负载均衡器"}},[s._v("#")]),s._v(" 9.Nginx的配置，由它作为负载均衡器")]),s._v(" "),n("p",[s._v("1.下载和安装参考文档nginx安装")]),s._v(" "),n("p",[s._v("2.安装好后，查看nginx在哪")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("whereis nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("3.进入目录")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /usr/local/nginx/conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("4.备份")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp nginx.conf nginx.conf.bf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("5.修改配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vi nginx.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("6.内容：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#增加映射端口\nupstream cluster{\n        server 127.0.0.1:3333;\n        server 127.0.0.1:4444;\n        server 127.0.0.1:5555;\n}\n#修改端口和location\nserver {\n        listen       1111;\n        server_name  localhost;\n        #charset koi8-r;\n        #access_log  logs/host.access.log  main;\n        location / {\n            #root   html;\n            #index  index.html index.htm;\n            proxy_pass http://cluster;\n        }\n.......省略\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("7.执行命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /usr/local/nginx/sbin\n#指定的配置文件启动\n./nginx -c /usr/local/nginx/conf/nginx.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("8.测试")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("访问地址：http://192.168.188.128:1111/nacos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"_11-微服务cloudalibaba-provider-payment9001启动注册进nacos集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-微服务cloudalibaba-provider-payment9001启动注册进nacos集群"}},[s._v("#")]),s._v(" 11.微服务cloudalibaba-provider-payment9001启动注册进nacos集群")]),s._v(" "),n("p",[s._v("server-addr：配置ngnix的IP+端口进行转发")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server:\n  port: 9001\n\nspring:\n  application:\n    name: nacos-payment-provider\n  cloud:\n    nacos:\n      discovery:\n      #server-addr: localhost:8848 #配置Nacos地址\n        #配置nginx转发地址\n        server-addr: 192.168.188.128:1111\n\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: '*'\n\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);