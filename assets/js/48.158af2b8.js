(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{487:function(s,a,t){"use strict";t.r(a);var n=t(8),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"sentinel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentinel"}},[s._v("#")]),s._v(" Sentinel")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用手册"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"_1-hystrix和sentinel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-hystrix和sentinel"}},[s._v("#")]),s._v(" 1.hystrix和sentinel")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210831104015667.png",alt:"image-20210831104015667"}})]),s._v(" "),t("h2",{attrs:{id:"_2-sentinel的特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-sentinel的特性"}},[s._v("#")]),s._v(" 2.sentinel的特性")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("丰富的应用场景")]),s._v("：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。")]),s._v(" "),t("li",[t("strong",[s._v("完备的实时监控")]),s._v("：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。")]),s._v(" "),t("li",[t("strong",[s._v("广泛的开源生态")]),s._v("：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Apache Dubbo、gRPC、Quarkus 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。同时 Sentinel 提供 Java/Go/C++ 等多语言的原生实现。")]),s._v(" "),t("li",[t("strong",[s._v("完善的 SPI 扩展机制")]),s._v("：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。")])]),s._v(" "),t("h2",{attrs:{id:"_3-sentinel下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-sentinel下载"}},[s._v("#")]),s._v(" 3.sentinel下载")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/alibaba/Sentinel/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("版本：1.7.0")]),s._v(" "),t("p",[s._v("运行：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("java -jar sentinel-dashboard-1.7.0.jar\n\n//linux后台启动\nnohup java -jar sentinel-dashboard-1.7.2.jar --server.port=8718 &\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("访问：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://localhost:8080/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("登录账号密码均为sentinel")]),s._v(" "),t("h2",{attrs:{id:"_4-sentinel能干嘛"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-sentinel能干嘛"}},[s._v("#")]),s._v(" 4.sentinel能干嘛")]),s._v(" "),t("ul",[t("li",[s._v("服务雪崩")]),s._v(" "),t("li",[s._v("服务降级")]),s._v(" "),t("li",[s._v("服务熔断")]),s._v(" "),t("li",[s._v("服务限流")])]),s._v(" "),t("h2",{attrs:{id:"_5-微服务注册进sentinel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-微服务注册进sentinel"}},[s._v("#")]),s._v(" 5.微服务注册进sentinel")]),s._v(" "),t("h3",{attrs:{id:"_1-新建模块-cloudalibaba-sentinel-service8401"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-新建模块-cloudalibaba-sentinel-service8401"}},[s._v("#")]),s._v(" 1.新建模块：cloudalibaba-sentinel-service8401")]),s._v(" "),t("h3",{attrs:{id:"_2-导入依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-导入依赖"}},[s._v("#")]),s._v(" 2.导入依赖")]),s._v(" "),t("ul",[t("li",[s._v("spring-cloud-starter-alibaba-nacos-discovery：nacos注册")]),s._v(" "),t("li",[s._v("spring-cloud-starter-alibaba-sentinel：sentinel服务")]),s._v(" "),t("li",[s._v("sentinel-datasource-nacos：持久化")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <artifactId>CloudStudy</artifactId>\n        <groupId>com.wcy.springcloud</groupId>\n        <version>1.0-SNAPSHOT</version>\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>cloudalibaba-sentinel-service8401</artifactId>\n\n    <dependencies>\n        \x3c!--SpringCloud ailibaba nacos --\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n        \x3c!--SpringCloud ailibaba sentinel-datasource-nacos 后续做持久化用到--\x3e\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n        </dependency>\n        \x3c!--SpringCloud ailibaba sentinel --\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\n        </dependency>\n        \x3c!--openfeign--\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-openfeign</artifactId>\n        </dependency>\n        \x3c!-- SpringBoot整合Web组件+actuator --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n        \x3c!--日常通用jar包配置--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-devtools</artifactId>\n            <scope>runtime</scope>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>cn.hutool</groupId>\n            <artifactId>hutool-all</artifactId>\n            <version>4.6.3</version>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n\n    </dependencies>\n\n</project>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br")])]),t("h3",{attrs:{id:"_3-修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改配置文件"}},[s._v("#")]),s._v(" 3.修改配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server:\n  port: 8401\n\nspring:\n  application:\n    name: cloudalibaba-sentinel-service\n  cloud:\n    nacos:\n      discovery:\n        #Nacos服务注册中心地址\n        server-addr: localhost:8848\n    sentinel:\n      transport:\n        #配置Sentinel dashboard地址\n        dashboard: localhost:8080\n        #默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口\n        port: 8719\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: '*'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h3",{attrs:{id:"_4-主启动类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-主启动类"}},[s._v("#")]),s._v(" 4.主启动类")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("package com.wcy.springcloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class MainApp8401\n{\n    public static void main(String[] args) {\n        SpringApplication.run(MainApp8401.class, args);\n    }\n}\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_5-业务类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-业务类"}},[s._v("#")]),s._v(" 5.业务类")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('package com.wcy.springcloud.controller;\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class FlowLimitController\n{\n\n    @GetMapping("/testA")\n    public String testA()\n    {\n        return "------testA";\n    }\n\n    @GetMapping("/testB")\n    public String testB()\n    {\n        return "------testB";\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"_6-环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-环境准备"}},[s._v("#")]),s._v(" 6.环境准备")]),s._v(" "),t("ul",[t("li",[s._v("启动nacos8848")]),s._v(" "),t("li",[s._v("启动sentinel8080")]),s._v(" "),t("li",[s._v("启动微服务8401")])]),s._v(" "),t("h3",{attrs:{id:"_7-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-测试"}},[s._v("#")]),s._v(" 7.测试")]),s._v(" "),t("p",[s._v("访问：http://localhost:8080/，发现并没有监控8401，是因为sentinel默认使用懒加载策略，只有8401访问了的url才会被注册进去。")]),s._v(" "),t("blockquote",[t("p",[s._v("访问http://localhost:8401/testA和http://localhost:8401/testB")])]),s._v(" "),t("p",[s._v("可以看到8401已经被sentinel监控")]),s._v(" "),t("h2",{attrs:{id:"_6-sentinel流控规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-sentinel流控规则"}},[s._v("#")]),s._v(" 6.Sentinel流控规则")]),s._v(" "),t("p",[s._v("可对某url进行流量控制")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210901095055098.png",alt:"image-20210901095055098"}})]),s._v(" "),t("h3",{attrs:{id:"_1-流控模式-qps直接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-流控模式-qps直接"}},[s._v("#")]),s._v(" 1.流控模式-QPS直接")]),s._v(" "),t("p",[s._v("对/testA该URL进行流量控制，一秒超过一次请求则直接抛出错误")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210901095214083.png",alt:"image-20210901095214083"}})]),s._v(" "),t("p",[s._v("再次访问http://localhost:8401/testA，一秒进行一次请求是正常的，多点几次就会直接报错：")]),s._v(" "),t("blockquote",[t("p",[s._v("Blocked by Sentinel (flow limiting)")])]),s._v(" "),t("p",[s._v("直接->快速失败(默认的流控处理)的源码：com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController")]),s._v(" "),t("h3",{attrs:{id:"_2-流控模式-线程数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-流控模式-线程数"}},[s._v("#")]),s._v(" 2.流控模式-线程数")]),s._v(" "),t("ul",[t("li",[s._v("QPS：每秒多少次请求")]),s._v(" "),t("li",[s._v("线程数：该URL不能超过多少个线程数")])]),s._v(" "),t("p",[s._v("休眠一秒，模拟线程数，修改阈值为线程数，再访问http://localhost:8401/testA，不听的F5可以看到效果。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('    @GetMapping("/testA")\n    public String testA() throws InterruptedException {\n        TimeUnit.SECONDS.sleep(1L);//休眠一秒\n        return "------testA"+ UUID.randomUUID().toString();\n    }\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_3-流控模式-关联"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-流控模式-关联"}},[s._v("#")]),s._v(" 3.流控模式-关联")]),s._v(" "),t("blockquote",[t("p",[s._v("当配置/testA的url关联/testB的url，如果/testB该url访问流量过大，对应的/testA也会限流")]),s._v(" "),t("p",[s._v("别人惹事，自己限流")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210902141413245.png",alt:"image-20210902141413245"}})]),s._v(" "),t("h3",{attrs:{id:"_4-流控模式-链路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-流控模式-链路"}},[s._v("#")]),s._v(" 4.流控模式-链路")]),s._v(" "),t("p",[s._v("如果testA和testB都访问调用/testC,可以限制对testC设置限流，入门为testA，那么testA的QPS超过阈值则不允许访问。")]),s._v(" "),t("h3",{attrs:{id:"_5-预热模式warm-up"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-预热模式warm-up"}},[s._v("#")]),s._v(" 5.预热模式Warm Up")]),s._v(" "),t("p",[s._v("开始流量很少，但是后续突增流量，若不加以控制，服务可能宕机，所以给某个请求设置预热模式，比如设置阈值为10，则开始的时候只能请求3QPS，后续慢慢的增加到10；")]),s._v(" "),t("blockquote",[t("p",[s._v("如：秒杀系统在开启的瞬间，会有很多流量上来，很有可能把系统打死，预热方式就是把为了保护系统，可慢慢的把流量放进来，慢慢的把阀值增长到设置的阀值。")])]),s._v(" "),t("p",[s._v("对/testB设置预热模式，阈值为10，访问/testB开始的时候只有10/3的QPS，五秒后慢慢的加到10的QPS")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210902144020631.png",alt:"image-20210902144020631"}})]),s._v(" "),t("p",[s._v("说明：")]),s._v(" "),t("blockquote",[t("p",[s._v("公式：阈值除以coldFactor(默认值为3),经过预热时长后才会达到阈值")]),s._v(" "),t("p",[s._v("默认coldFactor为3，即请求 QPS 从 threshold / 3 开始，经预热时长逐渐升至设定的 QPS 阈值。")]),s._v(" "),t("p",[s._v("官网：https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8")]),s._v(" "),t("p",[s._v("源码：com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController")])]),s._v(" "),t("h3",{attrs:{id:"_6-排队等待"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-排队等待"}},[s._v("#")]),s._v(" 6.排队等待")]),s._v(" "),t("p",[s._v("请求服务不被直接拒绝，而是排队等待")]),s._v(" "),t("blockquote",[t("p",[s._v("匀速排队，阈值必须设置为QPS")]),s._v(" "),t("p",[s._v("官网：https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6")]),s._v(" "),t("p",[s._v("源码：com.alibaba.csp.sentinel.slots.block.flow.controller.RateLimiterController")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210902144931222.png",alt:"image-20210902144931222"}})]),s._v(" "),t("p",[s._v("设置每秒10的QPS，超过10后等待2秒")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210902150305548.png",alt:"image-20210902150305548"}})]),s._v(" "),t("p",[s._v("使用postman模拟并发测试：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210902150425084.png",alt:"image-20210902150425084"}})]),s._v(" "),t("p",[s._v("查看idea控制台，一秒只有10个请求")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210902150450667.png",alt:"image-20210902150450667"}})]),s._v(" "),t("h2",{attrs:{id:"_7-降级规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-降级规则"}},[s._v("#")]),s._v(" 7.降级规则")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"_1-rt平均响应时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-rt平均响应时间"}},[s._v("#")]),s._v(" 1.RT平均响应时间")]),s._v(" "),t("blockquote",[t("p",[s._v("平均响应时间(DEGRADE_GRADE_RT ):当1s内持续进入5个请求，对应时刻的平均响应时间(秒级）均超过阈值（ count，以 ms为单位)，那么在接下的时间窗口( DegradeRule中的timewindow，以s为单位)之内，对这个方法的调用都会自动地熔断(抛出DegradeException )。")]),s._v(" "),t("p",[s._v("注意Sentinel 默认统计的RT上限是4900 ms，超出此阈值的都会算作4900 ms，若需要变更此上限可以通过启动配置项-Dcsp.sentinel.statistic.max.rt=xxx来配置。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210903162713068.png",alt:"image-20210903162713068"}})]),s._v(" "),t("h4",{attrs:{id:"_1-controller中testa服务休眠一秒"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-controller中testa服务休眠一秒"}},[s._v("#")]),s._v(" 1.controller中testA服务休眠一秒")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('    @GetMapping("/testA")\n    public String testA() throws InterruptedException {\n        TimeUnit.SECONDS.sleep(1L);//休眠一秒\n        return "------testA"+ UUID.randomUUID().toString();\n    }\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_2-对testa服务设置降级规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-对testa服务设置降级规则"}},[s._v("#")]),s._v(" 2.对testA服务设置降级规则")]),s._v(" "),t("p",[s._v("1秒内超过五次请求切平均响应时间>500毫秒在2秒内触发降级")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210903162907052.png",alt:"image-20210903162907052"}})]),s._v(" "),t("h4",{attrs:{id:"_3-不停的f5访问http-localhost-8401-testa"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-不停的f5访问http-localhost-8401-testa"}},[s._v("#")]),s._v(" 3.不停的F5访问http://localhost:8401/testA")]),s._v(" "),t("p",[s._v("可以看到触发了降级，不允许访问，把RT设置为2000，就不会触发降级了。")]),s._v(" "),t("h3",{attrs:{id:"_2-异常比列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-异常比列"}},[s._v("#")]),s._v(" 2.异常比列")]),s._v(" "),t("blockquote",[t("p",[s._v("异常比例( DEGRADE_GRADE_EXCEPTION_RATIo ):当资源的每秒请求量>=5，并且每秒异常总数占通过量的比值超过阈值（ DegradeRule中的count ）之后，资源进入降级状态，即在接下的时间窗口( DegradeRule中的timeWindow，以s为单位)之内，对这个方法的调用都会自动地返回。异常比率的阈值范围是[0.0，1.0]，代表0% - 100%。")])]),s._v(" "),t("h4",{attrs:{id:"_1-controller层模拟异常请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-controller层模拟异常请求"}},[s._v("#")]),s._v(" 1.controller层模拟异常请求")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('    @GetMapping("/testA")\n    public String testA() throws InterruptedException {\n        int a=10/0;\n        return "------testA"+ UUID.randomUUID().toString();\n    }\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_2-sentinel设置降级规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-sentinel设置降级规则"}},[s._v("#")]),s._v(" 2.sentinel设置降级规则")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210903170558542.png",alt:"image-20210903170558542"}})]),s._v(" "),t("h4",{attrs:{id:"_3-访问http-localhost-8401-testa"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问http-localhost-8401-testa"}},[s._v("#")]),s._v(" 3.访问http://localhost:8401/testA")]),s._v(" "),t("p",[s._v("注意：http://localhost:8401/testA由于该请求百分之百会报错误，如果一秒内没有超过五次请求，那么就不会被sentinel降级，会直接弹出runtimeException的页面错误；若不停的F5，则可以看到sentinel对其进行了降级。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210903170745866.png",alt:"image-20210903170745866"}})]),s._v(" "),t("h3",{attrs:{id:"_3-异常数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-异常数"}},[s._v("#")]),s._v(" 3.异常数")]),s._v(" "),t("blockquote",[t("p",[s._v("异常数( DEGRADE_GRADE_EXCEPTION_COUNT ):当资源近1分钟的异常数目超过阈值之后会进行熔断。注意由于统计时间窗口是分钟级别的，若 timewindow小于60s，则结束熔断状态后仍可能再进入熔断状态。")])]),s._v(" "),t("h4",{attrs:{id:"_1-controller层模拟异常请求-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-controller层模拟异常请求-2"}},[s._v("#")]),s._v(" 1.controller层模拟异常请求")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('    @GetMapping("/testA")\n    public String testA() throws InterruptedException {\n        int a=10/0;\n        return "------testA"+ UUID.randomUUID().toString();\n    }\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_2-sentinel设置降级规则-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-sentinel设置降级规则-2"}},[s._v("#")]),s._v(" 2.sentinel设置降级规则")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wcy_dch/images/raw/master/img/image-20210903171420755.png",alt:"image-20210903171420755"}})]),s._v(" "),t("h4",{attrs:{id:"_3-访问http-localhost-8401-testa-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问http-localhost-8401-testa-2"}},[s._v("#")]),s._v(" 3.访问http://localhost:8401/testA")]),s._v(" "),t("p",[s._v("当70秒内异常数超过五次则触发降级规则")])])}),[],!1,null,null,null);a.default=e.exports}}]);